import{r as k}from"./request-DUXCQUKS.js";import{_ as M,r as D,a as h,o as S,c as F,b,d as s,w as e,e as n,f as t,t as i,g as E,h as L,i as N,j as y,E as _,k as V}from"./index-DAxeeS1H.js";import"./index-B9ygI19o.js";function I(){return k({url:"/dashboard/stats",method:"get"})}function R(){return k({url:"/file-cleanup/cleanup",method:"post"})}const $={class:"dashboard-container"},j={class:"stat-content"},q={class:"stat-icon",style:{"background-color":"#007aff"}},G={class:"stat-info"},K={class:"stat-value"},H={class:"stat-content"},J={class:"stat-icon",style:{"background-color":"#34c759"}},O={class:"stat-info"},P={class:"stat-value"},Q={class:"stat-content"},W={class:"stat-icon",style:{"background-color":"#ff9500"}},X={class:"stat-info"},Y={class:"stat-value"},Z={class:"stat-content"},tt={class:"stat-icon",style:{"background-color":"#ff3b30"}},st={class:"stat-info"},at={class:"stat-value"},et={class:"card-header"},ot={class:"overview-item"},lt={class:"overview-value"},nt={class:"overview-item"},ct={class:"overview-value"},dt={__name:"Dashboard",setup(it){const l=D({totalAccounts:0,availableAccounts:0,runningTasks:0,todayUpload:0}),u=h(!1),v=h(!1),w=o=>{if(o===0)return"0 B";const a=1024,p=["B","KB","MB","GB","TB"],c=Math.floor(Math.log(o)/Math.log(a));return(o/Math.pow(a,c)).toFixed(2)+" "+p[c]},f=async()=>{u.value=!0;try{const o=await I();o.code===200?(l.totalAccounts=o.data.totalAccounts||0,l.availableAccounts=o.data.availableAccounts||0,l.runningTasks=o.data.runningTasks||0,l.todayUpload=o.data.todayUploadSize||0):_.error(o.message||"加载统计数据失败")}catch(o){console.error("加载统计数据失败:",o),_.error("加载统计数据失败")}finally{u.value=!1}},x=async()=>{try{await V.confirm("此操作将删除所有已上传成功的文件物理文件，释放服务器磁盘空间。确认继续吗？","清理已上传文件",{confirmButtonText:"确认清理",cancelButtonText:"取消",type:"warning"}),v.value=!0;const o=await R();if(o.code===200){const a=o.data;_.success(`清理完成！成功删除 ${a.successCount} 个文件，释放空间 ${a.deletedSizeFormatted}`)}else _.error(o.message||"清理失败")}catch(o){o!=="cancel"&&(console.error("清理文件失败:",o),_.error("清理文件失败"))}finally{v.value=!1}};return S(()=>{f(),setInterval(f,3e4)}),(o,a)=>{const p=n("User"),c=n("el-icon"),r=n("el-card"),d=n("el-col"),B=n("CircleCheck"),A=n("List"),z=n("Upload"),m=n("el-row"),C=n("Delete"),g=n("el-button"),T=n("Refresh"),U=L("loading");return b(),F("div",$,[s(m,{gutter:16},{default:e(()=>[s(d,{xs:24,sm:12,md:6},{default:e(()=>[s(r,{class:"stat-card"},{default:e(()=>[t("div",j,[t("div",q,[s(c,{size:30},{default:e(()=>[s(p)]),_:1})]),t("div",G,[t("div",K,i(l.totalAccounts),1),a[0]||(a[0]=t("div",{class:"stat-label"},"总账号数",-1))])])]),_:1})]),_:1}),s(d,{xs:24,sm:12,md:6},{default:e(()=>[s(r,{class:"stat-card"},{default:e(()=>[t("div",H,[t("div",J,[s(c,{size:30},{default:e(()=>[s(B)]),_:1})]),t("div",O,[t("div",P,i(l.availableAccounts),1),a[1]||(a[1]=t("div",{class:"stat-label"},"可用账号",-1))])])]),_:1})]),_:1}),s(d,{xs:24,sm:12,md:6},{default:e(()=>[s(r,{class:"stat-card"},{default:e(()=>[t("div",Q,[t("div",W,[s(c,{size:30},{default:e(()=>[s(A)]),_:1})]),t("div",X,[t("div",Y,i(l.runningTasks),1),a[2]||(a[2]=t("div",{class:"stat-label"},"运行中任务",-1))])])]),_:1})]),_:1}),s(d,{xs:24,sm:12,md:6},{default:e(()=>[s(r,{class:"stat-card"},{default:e(()=>[t("div",Z,[t("div",tt,[s(c,{size:30},{default:e(()=>[s(z)]),_:1})]),t("div",st,[t("div",at,i(w(l.todayUpload)),1),a[3]||(a[3]=t("div",{class:"stat-label"},"今日上传",-1))])])]),_:1})]),_:1})]),_:1}),s(m,{gutter:16,style:{"margin-top":"16px"}},{default:e(()=>[s(d,{span:24},{default:e(()=>[E((b(),N(r,null,{header:e(()=>[t("div",et,[a[6]||(a[6]=t("span",null,"系统概览",-1)),t("div",null,[s(g,{type:"danger",size:"small",onClick:x,loading:v.value},{default:e(()=>[s(c,null,{default:e(()=>[s(C)]),_:1}),a[4]||(a[4]=y(" 清理已上传文件 ",-1))]),_:1},8,["loading"]),s(g,{type:"primary",size:"small",onClick:f,style:{"margin-left":"10px"}},{default:e(()=>[s(c,null,{default:e(()=>[s(T)]),_:1}),a[5]||(a[5]=y(" 刷新 ",-1))]),_:1})])])]),default:e(()=>[s(m,{gutter:16},{default:e(()=>[s(d,{span:12},{default:e(()=>[t("div",ot,[a[7]||(a[7]=t("div",{class:"overview-label"},"总任务数",-1)),t("div",lt,i(l.totalTasks||0),1)])]),_:1}),s(d,{span:12},{default:e(()=>[t("div",nt,[a[8]||(a[8]=t("div",{class:"overview-label"},"账号使用率",-1)),t("div",ct,i(l.totalAccounts>0?(l.availableAccounts/l.totalAccounts*100).toFixed(1):0)+"% ",1)])]),_:1})]),_:1})]),_:1})),[[U,u.value]])]),_:1})]),_:1})])}}},vt=M(dt,[["__scopeId","data-v-68917961"]]);export{vt as default};
