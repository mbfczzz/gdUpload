import{_ as Be,a as b,r as q,l as ze,o as Ne,m as Te,c as H,b as z,d as t,w as l,g as Se,e as u,u as g,n as Ee,p as Ue,j as o,f,s as J,q as Ae,v as Le,h as De,i as I,t as x,x as X,y as Q,z as Y,k as S,E as h}from"./index-Du7G4jX3.js";import{r as k}from"./request-jab3afSv.js";import"./index-B9ygI19o.js";function Z(s){return k({url:"/account/page",method:"get",params:s})}function Re(s){return k({url:"/account",method:"post",data:s})}function Me(s){return k({url:"/account",method:"put",data:s})}function $e(s){return k({url:`/account/${s}`,method:"delete"})}function qe(s){return k({url:"/account/batch",method:"delete",data:s})}function Ie(s,N){return k({url:`/account/${s}/status`,method:"put",params:{status:N}})}function Qe(s){return k({url:`/account/${s}/reset-quota`,method:"put"})}const je={class:"account-container"},Ge={key:2,style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Fe={__name:"Account",setup(s){const N=b("");let E=null,U=null;const j=()=>{const n=new Date;N.value=n.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},V=q({keyword:""}),i=q({current:1,size:10,total:0}),A=b([]),L=b(!1),D=b([]),C=b(!1),R=b("新增账号"),T=b(null),r=q({id:null,accountName:"",accountEmail:"",rcloneConfigName:"",dailyLimit:805306368e3,priority:0,status:1,remark:""}),G=ze({get:()=>Math.round(r.dailyLimit/1073741824),set:n=>{r.dailyLimit=n*1073741824}}),ee={accountName:[{required:!0,message:"请输入账号名称",trigger:"blur"}],accountEmail:[{required:!0,message:"请输入账号邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],rcloneConfigName:[{required:!0,message:"请输入rclone配置名称",trigger:"blur"}]},w=n=>{if(n===0)return"0 B";const e=1024,c=["B","KB","MB","GB","TB"],_=Math.floor(Math.log(n)/Math.log(e));return(n/Math.pow(e,_)).toFixed(2)+" "+c[_]},F=n=>n.status===0||n.dailyLimit===0?0:Math.round(n.usedQuota/n.dailyLimit*100),te=n=>{const e=F(n);return e>=90?"#F56C6C":e>=70?"#E6A23C":"#67C23A"},le=n=>({0:"info",1:"success",2:"danger"})[n]||"info",ae=n=>({0:"禁用",1:"启用",2:"已达上限"})[n]||"未知",ne=n=>n?new Date(n).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",oe=({row:n})=>n.status===0?"disabled-row":"",d=async()=>{L.value=!0;try{const n={current:i.current,size:i.size,keyword:V.keyword},e=await Z(n);A.value=e.data.records,i.total=e.data.total}catch(n){console.error("查询失败:",n)}finally{L.value=!1}},re=async()=>{try{const n={current:i.current,size:i.size,keyword:V.keyword},e=await Z(n);A.value=e.data.records,i.total=e.data.total}catch(n){console.error("静默刷新失败:",n)}},ue=()=>{V.keyword="",i.current=1,d()},se=n=>{D.value=n.map(e=>e.id)},ie=()=>{R.value="新增账号",Object.assign(r,{id:null,accountName:"",accountEmail:"",rcloneConfigName:"",dailyLimit:805306368e3,priority:0,status:1,remark:""}),C.value=!0},ce=n=>{R.value="编辑账号",Object.assign(r,n),C.value=!0},de=async()=>{T.value&&await T.value.validate(async n=>{if(n)try{r.id?(await Me(r),h.success("更新成功")):(await Re(r),h.success("添加成功")),C.value=!1,d()}catch(e){console.error("提交失败:",e)}})},me=()=>{var n;(n=T.value)==null||n.resetFields()},pe=n=>{S.confirm("确定要删除该账号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await $e(n.id),h.success("删除成功"),d()}catch(e){console.error("删除失败:",e)}})},fe=()=>{S.confirm("确定要删除选中的账号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await qe(D.value),h.success("删除成功"),d()}catch(n){console.error("删除失败:",n)}})},ge=n=>{const e=n.status===1?0:1,c=e===1?"启用":"禁用";S.confirm(`确定要${c}该账号吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ie(n.id,e),h.success(`${c}成功`),d()}catch(_){console.error("操作失败:",_)}})},_e=n=>{S.confirm("确定要重置该账号的配额吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Qe(n.id),h.success("重置成功"),d()}catch(e){console.error("重置失败:",e)}})};return Ne(()=>{j(),E=setInterval(j,1e3),d(),U=setInterval(re,3e4)}),Te(()=>{E&&clearInterval(E),U&&clearInterval(U)}),(n,e)=>{const c=u("el-icon"),_=u("el-statistic"),y=u("el-col"),P=u("el-alert"),M=u("el-row"),B=u("el-input"),p=u("el-button"),m=u("el-table-column"),ye=u("el-progress"),ve=u("el-tag"),O=u("el-tooltip"),be=u("el-table"),ke=u("el-pagination"),Ce=u("el-card"),v=u("el-form-item"),K=u("el-input-number"),W=u("el-radio"),xe=u("el-radio-group"),he=u("el-form"),Ve=u("el-dialog"),we=De("loading");return z(),H("div",je,[t(Ce,null,{default:l(()=>[t(M,{gutter:16,class:"time-info-bar"},{default:l(()=>[t(y,{span:8},{default:l(()=>[t(_,{title:"当前时间",value:N.value},{prefix:l(()=>[t(c,null,{default:l(()=>[t(g(Ee))]),_:1})]),_:1},8,["value"])]),_:1}),t(y,{span:8},{default:l(()=>[t(_,{title:"账号总数",value:i.total},{prefix:l(()=>[t(c,null,{default:l(()=>[t(g(Ue))]),_:1})]),_:1},8,["value"])]),_:1}),t(y,{span:8},{default:l(()=>[t(P,{title:"自动刷新",type:"success",closable:!1,"show-icon":""},{default:l(()=>[...e[12]||(e[12]=[o(" 每30秒自动刷新账号状态 ",-1)])]),_:1})]),_:1})]),_:1}),t(M,{gutter:16,style:{"margin-top":"12px"}},{default:l(()=>[t(y,{span:24},{default:l(()=>[t(P,{title:"Google Drive 配额说明",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...e[13]||(e[13]=[o(" • ",-1),f("strong",null,"每日0点重置",-1),o("：系统按照每天凌晨0点重置配额，不是滚动24小时窗口",-1),f("br",null,null,-1),o(" • ",-1),f("strong",null,"已使用",-1),o("和",-1),f("strong",null,"剩余配额",-1),o("显示的是今日从0点开始的累计数据",-1),f("br",null,null,-1),o(' • 当配额用完时状态自动变为"已达上限"，第二天0点后配额自动恢复并重新启用',-1),f("br",null,null,-1),o(" • 账号被禁用后会在24小时后自动解封（显示预计解封时间）",-1),f("br",null,null,-1),o(" • 系统每30秒自动刷新，无需手动操作 ",-1)])]),_:1})]),_:1})]),_:1}),t(M,{gutter:16,class:"search-bar"},{default:l(()=>[t(y,{span:6},{default:l(()=>[t(B,{modelValue:V.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>V.keyword=a),placeholder:"搜索账号名称或邮箱",clearable:"",onClear:d},{prefix:l(()=>[t(c,null,{default:l(()=>[t(g(J))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(y,{span:6},{default:l(()=>[t(p,{type:"primary",onClick:d},{default:l(()=>[t(c,null,{default:l(()=>[t(g(J))]),_:1}),e[14]||(e[14]=o(" 搜索 ",-1))]),_:1}),t(p,{onClick:ue},{default:l(()=>[...e[15]||(e[15]=[o("重置",-1)])]),_:1})]),_:1}),t(y,{span:12,class:"text-right"},{default:l(()=>[t(p,{type:"primary",onClick:ie},{default:l(()=>[t(c,null,{default:l(()=>[t(g(Ae))]),_:1}),e[16]||(e[16]=o(" 新增账号 ",-1))]),_:1}),t(p,{type:"danger",disabled:D.value.length===0,onClick:fe},{default:l(()=>[t(c,null,{default:l(()=>[t(g(Le))]),_:1}),e[17]||(e[17]=o(" 批量删除 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1}),Se((z(),I(be,{data:A.value,style:{width:"100%","margin-top":"16px"},onSelectionChange:se,"row-class-name":oe},{default:l(()=>[t(m,{type:"selection",width:"55"}),t(m,{prop:"accountName",label:"账号名称",width:"150"}),t(m,{prop:"accountEmail",label:"账号邮箱",width:"200"}),t(m,{prop:"rcloneConfigName",label:"Rclone配置",width:"150"}),t(m,{label:"每日限制",width:"120"},{default:l(({row:a})=>[o(x(w(a.dailyLimit)),1)]),_:1}),t(m,{label:"已使用",width:"120"},{default:l(({row:a})=>[f("span",{style:X({color:a.status===2?"#f56c6c":""})},x(a.status===0?w(0):w(a.usedQuota)),5)]),_:1}),t(m,{label:"剩余配额",width:"120"},{default:l(({row:a})=>[f("span",{style:X({color:a.remainingQuota<=0?"#f56c6c":"#67c23a",fontWeight:a.remainingQuota<=0?"bold":"normal"})},x(a.status===0?w(a.dailyLimit):w(a.remainingQuota)),5)]),_:1}),t(m,{label:"使用率",width:"150"},{default:l(({row:a})=>[t(ye,{percentage:F(a),color:te(a)},null,8,["percentage","color"])]),_:1}),t(m,{label:"状态",width:"150"},{default:l(({row:a})=>[t(ve,{type:le(a.status),effect:a.status===2?"dark":"light"},{default:l(()=>[o(x(ae(a.status)),1)]),_:2},1032,["type","effect"]),a.status===0?(z(),I(O,{key:0,content:"账号已被禁用，不会参与上传",placement:"top"},{default:l(()=>[t(c,{style:{"margin-left":"5px",color:"#909399","font-size":"16px"}},{default:l(()=>[t(g(Y))]),_:1})]),_:1})):Q("",!0),a.status===2?(z(),I(O,{key:1,content:"配额已用完，等待重置",placement:"top"},{default:l(()=>[t(c,{style:{"margin-left":"5px",color:"#f56c6c"}},{default:l(()=>[t(g(Y))]),_:1})]),_:1})):Q("",!0),a.status===0&&a.quotaResetTime?(z(),H("div",Ge," 预计解封: "+x(ne(a.quotaResetTime)),1)):Q("",!0)]),_:1}),t(m,{prop:"priority",label:"优先级",width:"80"}),t(m,{label:"操作",fixed:"right",width:"250"},{default:l(({row:a})=>[t(p,{link:"",type:"primary",onClick:$=>ce(a)},{default:l(()=>[...e[18]||(e[18]=[o(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:a.status===1?"warning":"success",onClick:$=>ge(a)},{default:l(()=>[o(x(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(p,{link:"",type:"primary",onClick:$=>_e(a)},{default:l(()=>[...e[19]||(e[19]=[o(" 重置配额 ",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"danger",onClick:$=>pe(a)},{default:l(()=>[...e[20]||(e[20]=[o(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[we,L.value]]),t(ke,{"current-page":i.current,"onUpdate:currentPage":e[1]||(e[1]=a=>i.current=a),"page-size":i.size,"onUpdate:pageSize":e[2]||(e[2]=a=>i.size=a),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(Ve,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=a=>C.value=a),title:R.value,width:"600px",onClose:me},{footer:l(()=>[t(p,{onClick:e[10]||(e[10]=a=>C.value=!1)},{default:l(()=>[...e[23]||(e[23]=[o("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:de},{default:l(()=>[...e[24]||(e[24]=[o("确定",-1)])]),_:1})]),default:l(()=>[t(he,{ref_key:"formRef",ref:T,model:r,rules:ee,"label-width":"120px"},{default:l(()=>[t(v,{label:"账号名称",prop:"accountName"},{default:l(()=>[t(B,{modelValue:r.accountName,"onUpdate:modelValue":e[3]||(e[3]=a=>r.accountName=a),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1}),t(v,{label:"账号邮箱",prop:"accountEmail"},{default:l(()=>[t(B,{modelValue:r.accountEmail,"onUpdate:modelValue":e[4]||(e[4]=a=>r.accountEmail=a),placeholder:"请输入账号邮箱"},null,8,["modelValue"])]),_:1}),t(v,{label:"Rclone配置",prop:"rcloneConfigName"},{default:l(()=>[t(B,{modelValue:r.rcloneConfigName,"onUpdate:modelValue":e[5]||(e[5]=a=>r.rcloneConfigName=a),placeholder:"请输入rclone配置名称"},null,8,["modelValue"])]),_:1}),t(v,{label:"每日限制(GB)",prop:"dailyLimit"},{default:l(()=>[t(K,{modelValue:G.value,"onUpdate:modelValue":e[6]||(e[6]=a=>G.value=a),min:1,max:1e4,placeholder:"默认750GB"},null,8,["modelValue"])]),_:1}),t(v,{label:"优先级",prop:"priority"},{default:l(()=>[t(K,{modelValue:r.priority,"onUpdate:modelValue":e[7]||(e[7]=a=>r.priority=a),min:0,max:100,placeholder:"数字越大优先级越高"},null,8,["modelValue"])]),_:1}),t(v,{label:"状态",prop:"status"},{default:l(()=>[t(xe,{modelValue:r.status,"onUpdate:modelValue":e[8]||(e[8]=a=>r.status=a)},{default:l(()=>[t(W,{label:1},{default:l(()=>[...e[21]||(e[21]=[o("启用",-1)])]),_:1}),t(W,{label:0},{default:l(()=>[...e[22]||(e[22]=[o("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"备注",prop:"remark"},{default:l(()=>[t(B,{modelValue:r.remark,"onUpdate:modelValue":e[9]||(e[9]=a=>r.remark=a),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},We=Be(Fe,[["__scopeId","data-v-895e0bc9"]]);export{We as default};
