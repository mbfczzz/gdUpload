import{r as w}from"./request-jab3afSv.js";import{_ as ae,a as g,o as te,c as q,b as p,d as l,w as a,f as C,e as s,j as r,g as oe,h as ne,i as v,y as x,t as z,R as se,E as u,k as re}from"./index-Du7G4jX3.js";import"./index-B9ygI19o.js";function ue(){return w({url:"/emby/config/list",method:"get"})}function de(d){return w({url:"/emby/config/save",method:"post",data:d})}function ie(d){return w({url:`/emby/config/${d}`,method:"delete"})}function me(d){return w({url:`/emby/config/${d}/default`,method:"put"})}function pe(d){return w({url:"/emby/config/test",method:"post",data:d})}function fe(d){return w({url:`/emby/config/${d}/toggle`,method:"put"})}const ge={class:"emby-config-container"},ce={class:"header-content"},ve={class:"config-name"},ye={__name:"EmbyConfig",setup(d){const D=g(!1),N=g(!1),A=g([]),y=g(!1),E=g("添加配置"),i=g("password"),$=g(null),o=g({id:null,configName:"",serverUrl:"",apiKey:"",username:"",password:"",userId:"",timeout:3e4,enabled:!0,isDefault:!1,remark:""}),S={configName:[{required:!0,message:"请输入配置名称",trigger:"blur"}],serverUrl:[{required:!0,message:"请输入服务器地址",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"请输入有效的URL",trigger:"blur"}],apiKey:[{required:i.value==="apiKey",message:"请输入API Key",trigger:"blur"}],username:[{required:i.value==="password",message:"请输入用户名",trigger:"blur"}],password:[{required:i.value==="password",message:"请输入密码",trigger:"blur"}]},U=async()=>{D.value=!0;try{const n=await ue();A.value=n.data}catch(n){u.error("加载配置失败: "+n.message)}finally{D.value=!1}},R=()=>{E.value="添加配置",i.value="password",o.value={id:null,configName:"",serverUrl:"",apiKey:"",username:"",password:"",userId:"",timeout:3e4,enabled:!0,isDefault:!1,remark:""},y.value=!0},M=n=>{E.value="编辑配置",i.value=n.apiKey?"apiKey":"password",o.value={...n},y.value=!0},j=async()=>{$.value&&await $.value.validate(async n=>{if(n){N.value=!0;try{const e={...o.value};i.value==="apiKey"?(e.username="",e.password=""):e.apiKey="",(await de(e)).code===200&&(u.success("保存成功"),y.value=!1,await U())}catch(e){u.error("保存失败: "+e.message)}finally{N.value=!1}}})},F=async n=>{try{await re.confirm(`确定要删除配置"${n.configName}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await ie(n.id)).code===200&&(u.success("删除成功"),await U())}catch(e){e!=="cancel"&&u.error("删除失败: "+e.message)}},L=async n=>{try{(await me(n.id)).code===200&&(u.success("设置成功"),await U())}catch(e){u.error("设置失败: "+e.message)}},G=async n=>{const e=u({message:"正在测试连接...",type:"info",duration:0});try{const _=await pe({id:n.id});e.close(),_.data?u.success("连接测试成功"):u.error("连接测试失败，请检查服务器地址、用户名和密码")}catch(_){e.close(),u.error("测试失败: "+_.message)}},H=async n=>{try{(await fe(n.id)).code===200&&u.success(n.enabled?"已启用":"已禁用")}catch(e){u.error("操作失败: "+e.message),n.enabled=!n.enabled}};return te(()=>{U()}),(n,e)=>{const _=s("Plus"),k=s("el-icon"),c=s("el-button"),B=s("el-card"),f=s("el-table-column"),K=s("el-tag"),I=s("el-switch"),J=s("Connection"),O=s("Star"),Q=s("Edit"),W=s("Delete"),X=s("el-table"),b=s("el-input"),m=s("el-form-item"),P=s("el-divider"),T=s("el-radio"),Y=s("el-radio-group"),Z=s("el-input-number"),h=s("el-form"),ee=s("el-dialog"),le=ne("loading");return p(),q("div",ge,[l(B,{class:"header-card"},{default:a(()=>[C("div",ce,[e[13]||(e[13]=C("h2",null,"Emby 配置管理",-1)),l(c,{type:"primary",onClick:R},{default:a(()=>[l(k,null,{default:a(()=>[l(_)]),_:1}),e[12]||(e[12]=r(" 添加配置 ",-1))]),_:1})])]),_:1}),l(B,null,{default:a(()=>[oe((p(),v(X,{data:A.value,border:"",stripe:""},{default:a(()=>[l(f,{type:"index",label:"#",width:"60",align:"center"}),l(f,{prop:"configName",label:"配置名称","min-width":"150"},{default:a(({row:t})=>[C("div",ve,[t.isDefault?(p(),v(K,{key:0,type:"success",size:"small"},{default:a(()=>[...e[14]||(e[14]=[r("默认",-1)])]),_:1})):x("",!0),C("span",null,z(t.configName),1)])]),_:1}),l(f,{prop:"serverUrl",label:"服务器地址","min-width":"200","show-overflow-tooltip":""}),l(f,{prop:"apiKey",label:"认证方式",width:"120",align:"center"},{default:a(({row:t})=>[t.apiKey?(p(),v(K,{key:0,type:"primary"},{default:a(()=>[...e[15]||(e[15]=[r("API Key",-1)])]),_:1})):t.username?(p(),v(K,{key:1,type:"warning"},{default:a(()=>[...e[16]||(e[16]=[r("用户名密码",-1)])]),_:1})):(p(),v(K,{key:2,type:"info"},{default:a(()=>[...e[17]||(e[17]=[r("未配置",-1)])]),_:1}))]),_:1}),l(f,{prop:"username",label:"用户名",width:"120"},{default:a(({row:t})=>[r(z(t.username||"-"),1)]),_:1}),l(f,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(I,{modelValue:t.enabled,"onUpdate:modelValue":V=>t.enabled=V,onChange:V=>H(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),l(f,{label:"操作",width:"280",fixed:"right"},{default:a(({row:t})=>[l(c,{type:"primary",link:"",size:"small",onClick:V=>G(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(J)]),_:1}),e[18]||(e[18]=r(" 测试 ",-1))]),_:1},8,["onClick"]),t.isDefault?x("",!0):(p(),v(c,{key:0,type:"success",link:"",size:"small",onClick:V=>L(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(O)]),_:1}),e[19]||(e[19]=r(" 设为默认 ",-1))]),_:1},8,["onClick"])),l(c,{type:"primary",link:"",size:"small",onClick:V=>M(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(Q)]),_:1}),e[20]||(e[20]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),l(c,{type:"danger",link:"",size:"small",onClick:V=>F(t)},{default:a(()=>[l(k,null,{default:a(()=>[l(W)]),_:1}),e[21]||(e[21]=r(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,D.value]])]),_:1}),l(ee,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=t=>y.value=t),title:E.value,width:"600px"},{footer:a(()=>[l(c,{onClick:e[10]||(e[10]=t=>y.value=!1)},{default:a(()=>[...e[27]||(e[27]=[r("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:j,loading:N.value},{default:a(()=>[...e[28]||(e[28]=[r(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(h,{ref_key:"formRef",ref:$,model:o.value,rules:S,"label-width":"120px"},{default:a(()=>[l(m,{label:"配置名称",prop:"configName"},{default:a(()=>[l(b,{modelValue:o.value.configName,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.configName=t),placeholder:"如：我的Emby服务器"},null,8,["modelValue"])]),_:1}),l(m,{label:"服务器地址",prop:"serverUrl"},{default:a(()=>[l(b,{modelValue:o.value.serverUrl,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.serverUrl=t),placeholder:"http://your-emby-server:8096"},null,8,["modelValue"])]),_:1}),l(P,{"content-position":"left"},{default:a(()=>[...e[22]||(e[22]=[r("认证方式",-1)])]),_:1}),l(m,{label:"认证类型"},{default:a(()=>[l(Y,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value=t)},{default:a(()=>[l(T,{label:"apiKey"},{default:a(()=>[...e[23]||(e[23]=[r("API Key",-1)])]),_:1}),l(T,{label:"password"},{default:a(()=>[...e[24]||(e[24]=[r("用户名密码",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),i.value==="apiKey"?(p(),v(m,{key:0,label:"API Key",prop:"apiKey"},{default:a(()=>[l(b,{modelValue:o.value.apiKey,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.apiKey=t),type:"password","show-password":"",placeholder:"输入 API Key"},null,8,["modelValue"])]),_:1})):x("",!0),i.value==="password"?(p(),q(se,{key:1},[l(m,{label:"用户名",prop:"username"},{default:a(()=>[l(b,{modelValue:o.value.username,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.username=t),placeholder:"输入用户名"},null,8,["modelValue"])]),_:1}),l(m,{label:"密码",prop:"password"},{default:a(()=>[l(b,{modelValue:o.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.password=t),type:"password","show-password":"",placeholder:"输入密码"},null,8,["modelValue"])]),_:1})],64)):x("",!0),l(P,{"content-position":"left"},{default:a(()=>[...e[25]||(e[25]=[r("其他设置",-1)])]),_:1}),l(m,{label:"超时时间"},{default:a(()=>[l(Z,{modelValue:o.value.timeout,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.timeout=t),min:5e3,max:12e4,step:1e3},null,8,["modelValue"]),e[26]||(e[26]=C("span",{style:{"margin-left":"10px",color:"#909399"}},"毫秒",-1))]),_:1}),l(m,{label:"启用"},{default:a(()=>[l(I,{modelValue:o.value.enabled,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.enabled=t)},null,8,["modelValue"])]),_:1}),l(m,{label:"设为默认"},{default:a(()=>[l(I,{modelValue:o.value.isDefault,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.isDefault=t)},null,8,["modelValue"])]),_:1}),l(m,{label:"备注"},{default:a(()=>[l(b,{modelValue:o.value.remark,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.remark=t),type:"textarea",rows:3,placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},we=ae(ye,[["__scopeId","data-v-e4aba41d"]]);export{we as default};
