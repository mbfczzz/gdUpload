import{_ as ze,a as C,r as q,l as Ne,o as Te,m as Ee,c as H,b as z,d as t,w as l,g as Se,e as u,u as _,n as $e,p as Ae,j as n,f as g,s as J,q as Ue,v as Le,h as De,i as I,t as h,x as X,y as Q,z as Y,k as S,E as f}from"./index-DS01B9Je.js";import{r as y}from"./request-BcqQ-M1s.js";import"./index-B9ygI19o.js";function Z(i){return y({url:"/account/page",method:"get",params:i})}function Me(i){return y({url:"/account",method:"post",data:i})}function Re(i){return y({url:"/account",method:"put",data:i})}function qe(i){return y({url:`/account/${i}`,method:"delete"})}function Ie(i){return y({url:"/account/batch",method:"delete",data:i})}function Qe(i,N){return y({url:`/account/${i}/status`,method:"put",params:{status:N}})}function je(i){return y({url:`/account/${i}/reset-quota`,method:"put"})}function Ge(i){return y({url:`/account/${i}/probe`,method:"post"})}const Pe={class:"account-container"},Fe={key:2,style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Oe={__name:"Account",setup(i){const N=C("");let $=null,A=null;const j=()=>{const o=new Date;N.value=o.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},V=q({keyword:""}),c=q({current:1,size:10,total:0}),U=C([]),L=C(!1),D=C([]),x=C(!1),M=C("新增账号"),T=C(null),s=q({id:null,accountName:"",accountEmail:"",rcloneConfigName:"",dailyLimit:805306368e3,priority:0,status:1,remark:""}),G=Ne({get:()=>Math.round(s.dailyLimit/1073741824),set:o=>{s.dailyLimit=o*1073741824}}),ee={accountName:[{required:!0,message:"请输入账号名称",trigger:"blur"}],accountEmail:[{required:!0,message:"请输入账号邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],rcloneConfigName:[{required:!0,message:"请输入rclone配置名称",trigger:"blur"}]},w=o=>{if(o===0)return"0 B";const e=1024,r=["B","KB","MB","GB","TB"],b=Math.floor(Math.log(o)/Math.log(e));return(o/Math.pow(e,b)).toFixed(2)+" "+r[b]},P=o=>o.status===0||o.dailyLimit===0?0:Math.round(o.usedQuota/o.dailyLimit*100),te=o=>{const e=P(o);return e>=90?"#F56C6C":e>=70?"#E6A23C":"#67C23A"},le=o=>({0:"info",1:"success",2:"danger"})[o]||"info",ae=o=>({0:"禁用",1:"启用",2:"已达上限"})[o]||"未知",oe=o=>o?new Date(o).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ne=({row:o})=>o.status===0?"disabled-row":"",d=async()=>{L.value=!0;try{const o={current:c.current,size:c.size,keyword:V.keyword},e=await Z(o);U.value=e.data.records,c.total=e.data.total}catch(o){console.error("查询失败:",o)}finally{L.value=!1}},re=async()=>{try{const o={current:c.current,size:c.size,keyword:V.keyword},e=await Z(o);U.value=e.data.records,c.total=e.data.total}catch(o){console.error("静默刷新失败:",o)}},se=()=>{V.keyword="",c.current=1,d()},ue=o=>{D.value=o.map(e=>e.id)},ie=()=>{M.value="新增账号",Object.assign(s,{id:null,accountName:"",accountEmail:"",rcloneConfigName:"",dailyLimit:805306368e3,priority:0,status:1,remark:""}),x.value=!0},ce=o=>{M.value="编辑账号",Object.assign(s,o),x.value=!0},de=async()=>{T.value&&await T.value.validate(async o=>{if(o)try{s.id?(await Re(s),f.success("更新成功")):(await Me(s),f.success("添加成功")),x.value=!1,d()}catch(e){console.error("提交失败:",e)}})},me=()=>{var o;(o=T.value)==null||o.resetFields()},pe=o=>{S.confirm("确定要删除该账号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await qe(o.id),f.success("删除成功"),d()}catch(e){console.error("删除失败:",e)}})},fe=()=>{S.confirm("确定要删除选中的账号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ie(D.value),f.success("删除成功"),d()}catch(o){console.error("删除失败:",o)}})},ge=o=>{const e=o.status===1?0:1,r=e===1?"启用":"禁用";S.confirm(`确定要${r}该账号吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Qe(o.id,e),f.success(`${r}成功`),d()}catch(b){console.error("操作失败:",b)}})},_e=o=>{S.confirm("确定要重置该账号的配额吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await je(o.id),f.success("重置成功"),d()}catch(e){console.error("重置失败:",e)}})},ye=async o=>{const e=f({message:"正在探测账号，请稍候...",type:"info",duration:0});try{const r=await Ge(o.id);e.close(),r.code===200?f.success(`探测成功: ${r.data.message}`):r.data&&r.data.quotaExceeded?f.error("探测失败: 配额超限"):f.error(`探测失败: ${r.message}`),d()}catch(r){e.close(),f.error("探测失败: "+(r.message||"未知错误")),console.error("探测失败:",r)}};return Te(()=>{j(),$=setInterval(j,1e3),d(),A=setInterval(re,3e4)}),Ee(()=>{$&&clearInterval($),A&&clearInterval(A)}),(o,e)=>{const r=u("el-icon"),b=u("el-statistic"),v=u("el-col"),F=u("el-alert"),R=u("el-row"),B=u("el-input"),m=u("el-button"),p=u("el-table-column"),be=u("el-progress"),ve=u("el-tag"),O=u("el-tooltip"),ke=u("el-table"),Ce=u("el-pagination"),xe=u("el-card"),k=u("el-form-item"),K=u("el-input-number"),W=u("el-radio"),he=u("el-radio-group"),Ve=u("el-form"),we=u("el-dialog"),Be=De("loading");return z(),H("div",Pe,[t(xe,null,{default:l(()=>[t(R,{gutter:16,class:"time-info-bar"},{default:l(()=>[t(v,{span:8},{default:l(()=>[t(b,{title:"当前时间",value:N.value},{prefix:l(()=>[t(r,null,{default:l(()=>[t(_($e))]),_:1})]),_:1},8,["value"])]),_:1}),t(v,{span:8},{default:l(()=>[t(b,{title:"账号总数",value:c.total},{prefix:l(()=>[t(r,null,{default:l(()=>[t(_(Ae))]),_:1})]),_:1},8,["value"])]),_:1}),t(v,{span:8},{default:l(()=>[t(F,{title:"自动刷新",type:"success",closable:!1,"show-icon":""},{default:l(()=>[...e[12]||(e[12]=[n(" 每30秒自动刷新账号状态 ",-1)])]),_:1})]),_:1})]),_:1}),t(R,{gutter:16,style:{"margin-top":"12px"}},{default:l(()=>[t(v,{span:24},{default:l(()=>[t(F,{title:"Google Drive 配额说明",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...e[13]||(e[13]=[n(" • ",-1),g("strong",null,"每日0点重置",-1),n("：系统按照每天凌晨0点重置配额，不是滚动24小时窗口",-1),g("br",null,null,-1),n(" • ",-1),g("strong",null,"已使用",-1),n("和",-1),g("strong",null,"剩余配额",-1),n("显示的是今日从0点开始的累计数据",-1),g("br",null,null,-1),n(' • 当配额用完时状态自动变为"已达上限"，第二天0点后配额自动恢复并重新启用',-1),g("br",null,null,-1),n(" • 账号被禁用后会在24小时后自动解封（显示预计解封时间）",-1),g("br",null,null,-1),n(" • 系统每30秒自动刷新，无需手动操作 ",-1)])]),_:1})]),_:1})]),_:1}),t(R,{gutter:16,class:"search-bar"},{default:l(()=>[t(v,{span:6},{default:l(()=>[t(B,{modelValue:V.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>V.keyword=a),placeholder:"搜索账号名称或邮箱",clearable:"",onClear:d},{prefix:l(()=>[t(r,null,{default:l(()=>[t(_(J))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{span:6},{default:l(()=>[t(m,{type:"primary",onClick:d},{default:l(()=>[t(r,null,{default:l(()=>[t(_(J))]),_:1}),e[14]||(e[14]=n(" 搜索 ",-1))]),_:1}),t(m,{onClick:se},{default:l(()=>[...e[15]||(e[15]=[n("重置",-1)])]),_:1})]),_:1}),t(v,{span:12,class:"text-right"},{default:l(()=>[t(m,{type:"primary",onClick:ie},{default:l(()=>[t(r,null,{default:l(()=>[t(_(Ue))]),_:1}),e[16]||(e[16]=n(" 新增账号 ",-1))]),_:1}),t(m,{type:"danger",disabled:D.value.length===0,onClick:fe},{default:l(()=>[t(r,null,{default:l(()=>[t(_(Le))]),_:1}),e[17]||(e[17]=n(" 批量删除 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1}),Se((z(),I(ke,{data:U.value,style:{width:"100%","margin-top":"16px"},onSelectionChange:ue,"row-class-name":ne},{default:l(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"accountName",label:"账号名称",width:"150"}),t(p,{prop:"accountEmail",label:"账号邮箱",width:"200"}),t(p,{prop:"rcloneConfigName",label:"Rclone配置",width:"150"}),t(p,{label:"每日限制",width:"120"},{default:l(({row:a})=>[n(h(w(a.dailyLimit)),1)]),_:1}),t(p,{label:"已使用",width:"120"},{default:l(({row:a})=>[g("span",{style:X({color:a.status===2?"#f56c6c":""})},h(a.status===0?w(0):w(a.usedQuota)),5)]),_:1}),t(p,{label:"剩余配额",width:"120"},{default:l(({row:a})=>[g("span",{style:X({color:a.remainingQuota<=0?"#f56c6c":"#67c23a",fontWeight:a.remainingQuota<=0?"bold":"normal"})},h(a.status===0?w(a.dailyLimit):w(a.remainingQuota)),5)]),_:1}),t(p,{label:"使用率",width:"150"},{default:l(({row:a})=>[t(be,{percentage:P(a),color:te(a)},null,8,["percentage","color"])]),_:1}),t(p,{label:"状态",width:"150"},{default:l(({row:a})=>[t(ve,{type:le(a.status),effect:a.status===2?"dark":"light"},{default:l(()=>[n(h(ae(a.status)),1)]),_:2},1032,["type","effect"]),a.status===0?(z(),I(O,{key:0,content:"账号已被禁用，不会参与上传",placement:"top"},{default:l(()=>[t(r,{style:{"margin-left":"5px",color:"#909399","font-size":"16px"}},{default:l(()=>[t(_(Y))]),_:1})]),_:1})):Q("",!0),a.status===2?(z(),I(O,{key:1,content:"配额已用完，等待重置",placement:"top"},{default:l(()=>[t(r,{style:{"margin-left":"5px",color:"#f56c6c"}},{default:l(()=>[t(_(Y))]),_:1})]),_:1})):Q("",!0),a.status===0&&a.quotaResetTime?(z(),H("div",Fe," 预计解封: "+h(oe(a.quotaResetTime)),1)):Q("",!0)]),_:1}),t(p,{prop:"priority",label:"优先级",width:"80"}),t(p,{label:"操作",fixed:"right",width:"300"},{default:l(({row:a})=>[t(m,{link:"",type:"primary",onClick:E=>ce(a)},{default:l(()=>[...e[18]||(e[18]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:a.status===1?"warning":"success",onClick:E=>ge(a)},{default:l(()=>[n(h(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(m,{link:"",type:"primary",onClick:E=>ye(a)},{default:l(()=>[...e[19]||(e[19]=[n(" 探测 ",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:"primary",onClick:E=>_e(a)},{default:l(()=>[...e[20]||(e[20]=[n(" 重置配额 ",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:"danger",onClick:E=>pe(a)},{default:l(()=>[...e[21]||(e[21]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Be,L.value]]),t(Ce,{"current-page":c.current,"onUpdate:currentPage":e[1]||(e[1]=a=>c.current=a),"page-size":c.size,"onUpdate:pageSize":e[2]||(e[2]=a=>c.size=a),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(we,{modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=a=>x.value=a),title:M.value,width:"600px",onClose:me},{footer:l(()=>[t(m,{onClick:e[10]||(e[10]=a=>x.value=!1)},{default:l(()=>[...e[24]||(e[24]=[n("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:de},{default:l(()=>[...e[25]||(e[25]=[n("确定",-1)])]),_:1})]),default:l(()=>[t(Ve,{ref_key:"formRef",ref:T,model:s,rules:ee,"label-width":"120px"},{default:l(()=>[t(k,{label:"账号名称",prop:"accountName"},{default:l(()=>[t(B,{modelValue:s.accountName,"onUpdate:modelValue":e[3]||(e[3]=a=>s.accountName=a),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1}),t(k,{label:"账号邮箱",prop:"accountEmail"},{default:l(()=>[t(B,{modelValue:s.accountEmail,"onUpdate:modelValue":e[4]||(e[4]=a=>s.accountEmail=a),placeholder:"请输入账号邮箱"},null,8,["modelValue"])]),_:1}),t(k,{label:"Rclone配置",prop:"rcloneConfigName"},{default:l(()=>[t(B,{modelValue:s.rcloneConfigName,"onUpdate:modelValue":e[5]||(e[5]=a=>s.rcloneConfigName=a),placeholder:"请输入rclone配置名称"},null,8,["modelValue"])]),_:1}),t(k,{label:"每日限制(GB)",prop:"dailyLimit"},{default:l(()=>[t(K,{modelValue:G.value,"onUpdate:modelValue":e[6]||(e[6]=a=>G.value=a),min:1,max:1e4,placeholder:"默认750GB"},null,8,["modelValue"])]),_:1}),t(k,{label:"优先级",prop:"priority"},{default:l(()=>[t(K,{modelValue:s.priority,"onUpdate:modelValue":e[7]||(e[7]=a=>s.priority=a),min:0,max:100,placeholder:"数字越大优先级越高"},null,8,["modelValue"])]),_:1}),t(k,{label:"状态",prop:"status"},{default:l(()=>[t(he,{modelValue:s.status,"onUpdate:modelValue":e[8]||(e[8]=a=>s.status=a)},{default:l(()=>[t(W,{label:1},{default:l(()=>[...e[22]||(e[22]=[n("启用",-1)])]),_:1}),t(W,{label:0},{default:l(()=>[...e[23]||(e[23]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"备注",prop:"remark"},{default:l(()=>[t(B,{modelValue:s.remark,"onUpdate:modelValue":e[9]||(e[9]=a=>s.remark=a),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Je=ze(Oe,[["__scopeId","data-v-cdcc3551"]]);export{Je as default};
