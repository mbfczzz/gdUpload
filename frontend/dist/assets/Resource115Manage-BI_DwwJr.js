import{_ as se,a as u,o as de,c as ie,b as B,d as e,w as a,f as I,e as s,j as d,u as f,W as ce,q as me,N as pe,v as j,t as q,S as fe,s as N,g as ve,h as ge,i as P,L as _e,E as r,k as K}from"./index-DS01B9Je.js";import{r as b}from"./request-BcqQ-M1s.js";import"./index-B9ygI19o.js";function be(i,_,y){return b({url:"/resource115/manage/page",method:"get",params:{page:i,size:_,keyword:y}})}function ye(i){return b({url:"/resource115/manage",method:"post",data:i})}function he(i){return b({url:"/resource115/manage",method:"put",data:i})}function we(i){return b({url:`/resource115/manage/${i}`,method:"delete"})}function De(i){return b({url:"/resource115/manage/batch",method:"delete",data:i})}function Ve(i,_,y){return b({url:"/tmdb/search",method:"get",params:{name:i,year:_,type:y}})}function ke(){return b({url:"/tmdb/batch-fill",method:"post"})}const Ie={class:"resource115-container"},Be={class:"header-content"},Te={class:"header-left"},Ce={class:"header-actions"},xe={class:"pagination-container"},ze={__name:"Resource115Manage",setup(i){const _=u(!1),y=u([]),k=u(1),T=u(20),L=u(0),C=u(""),h=u([]),w=u(!1),x=u("添加资源"),z=u(null),n=u({id:null,name:"",tmdbId:"",type:"",size:"",url:"",code:""}),M=u(!1),R=u(!1),S=u(!1),F={name:[{required:!0,message:"请输入资源名称",trigger:"blur"}],url:[{required:!0,message:"请输入分享链接",trigger:"blur"}]},v=async()=>{_.value=!0;try{const t=await be(k.value,T.value,C.value);y.value=t.data.records,L.value=t.data.total}catch(t){console.error("加载资源列表失败:",t),r.error("加载资源列表失败: "+t.message)}finally{_.value=!1}},U=()=>{k.value=1,v()},A=()=>{k.value=1,v()},G=()=>{v()},W=t=>{h.value=t.map(l=>l.id)},H=()=>{x.value="添加资源",n.value={id:null,name:"",tmdbId:"",type:"",size:"",url:"",code:""},w.value=!0},J=t=>{x.value="编辑资源",n.value={...t},w.value=!0},O=async()=>{z.value&&await z.value.validate(async t=>{if(t){M.value=!0;try{n.value.id?(await he(n.value),r.success("更新成功")):(await ye(n.value),r.success("添加成功")),w.value=!1,v()}catch(l){console.error("操作失败:",l),r.error("操作失败: "+l.message)}finally{M.value=!1}}})},Q=async t=>{try{await K.confirm(`确定要删除资源 "${t.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await we(t.id),r.success("删除成功"),v()}catch(l){l!=="cancel"&&(console.error("删除失败:",l),r.error("删除失败: "+l.message))}},X=async()=>{try{await K.confirm(`确定要删除选中的 ${h.value.length} 个资源吗？`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De(h.value),r.success("批量删除成功"),h.value=[],v()}catch(t){t!=="cancel"&&(console.error("批量删除失败:",t),r.error("批量删除失败: "+t.message))}},Y=async()=>{if(!n.value.name){r.warning("请先输入资源名称");return}R.value=!0;try{const t=n.value.name.match(/\((\d{4})\)/),l=t?parseInt(t[1]):null,c=await Ve(n.value.name,l,n.value.type);c.data?(n.value.tmdbId=c.data,r.success("找到 TMDB ID: "+c.data)):r.warning("未找到匹配的 TMDB ID")}catch(t){console.error("搜索 TMDB ID 失败:",t),r.error("搜索失败: "+t.message)}finally{R.value=!1}},Z=async()=>{try{await K.confirm("确定要批量补充所有资源的 TMDB ID 吗？这可能需要几分钟时间。","确认批量补充",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),S.value=!0,r.info("正在批量补充 TMDB ID，请稍候...");const t=await ke();r.success(t.data.message),v()}catch(t){t!=="cancel"&&(console.error("批量补充失败:",t),r.error("批量补充失败: "+t.message))}finally{S.value=!1}};return de(()=>{v()}),(t,l)=>{const c=s("el-icon"),$=s("el-tag"),m=s("el-button"),E=s("el-card"),D=s("el-input"),p=s("el-table-column"),ee=s("el-link"),le=s("el-table"),ae=s("el-pagination"),V=s("el-form-item"),g=s("el-option"),te=s("el-select"),oe=s("el-form"),ne=s("el-dialog"),re=ge("loading");return B(),ie("div",Ie,[e(E,{class:"header-card"},{default:a(()=>[I("div",Be,[I("div",Te,[l[12]||(l[12]=I("h2",null,"115 资源管理",-1)),e($,{type:"success",size:"large"},{default:a(()=>[e(c,null,{default:a(()=>[e(f(ce))]),_:1}),l[11]||(l[11]=d(" 资源库 ",-1))]),_:1})]),I("div",Ce,[e(m,{type:"primary",onClick:H},{default:a(()=>[e(c,null,{default:a(()=>[e(f(me))]),_:1}),l[13]||(l[13]=d(" 添加资源 ",-1))]),_:1}),e(m,{type:"warning",onClick:Z,loading:S.value},{default:a(()=>[e(c,null,{default:a(()=>[e(f(pe))]),_:1}),l[14]||(l[14]=d(" 批量补充 TMDB ID ",-1))]),_:1},8,["loading"]),e(m,{type:"danger",disabled:h.value.length===0,onClick:X},{default:a(()=>[e(c,null,{default:a(()=>[e(f(j))]),_:1}),d(" 批量删除 ("+q(h.value.length)+") ",1)]),_:1},8,["disabled"])])])]),_:1}),e(E,{class:"search-card"},{default:a(()=>[e(D,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=o=>C.value=o),placeholder:"搜索资源名称、TMDB ID、类型...",clearable:"",onClear:U,onKeyup:fe(U,["enter"]),style:{"max-width":"400px"}},{prefix:a(()=>[e(c,null,{default:a(()=>[e(f(N))]),_:1})]),append:a(()=>[e(m,{onClick:U,icon:f(N)},{default:a(()=>[...l[15]||(l[15]=[d("搜索",-1)])]),_:1},8,["icon"])]),_:1},8,["modelValue"])]),_:1}),e(E,{class:"table-card"},{default:a(()=>[ve((B(),P(le,{data:y.value,onSelectionChange:W,stripe:"",border:""},{default:a(()=>[e(p,{type:"selection",width:"55"}),e(p,{prop:"id",label:"ID",width:"80"}),e(p,{prop:"name",label:"资源名称","min-width":"200","show-overflow-tooltip":""}),e(p,{prop:"tmdbId",label:"TMDB ID",width:"120"},{default:a(({row:o})=>[o.tmdbId?(B(),P($,{key:0,type:"success",size:"small"},{default:a(()=>[d(q(o.tmdbId),1)]),_:2},1024)):(B(),P($,{key:1,type:"info",size:"small"},{default:a(()=>[...l[16]||(l[16]=[d("未设置",-1)])]),_:1}))]),_:1}),e(p,{prop:"type",label:"类型",width:"120"}),e(p,{prop:"size",label:"大小",width:"100"}),e(p,{prop:"url",label:"分享链接","min-width":"200","show-overflow-tooltip":""},{default:a(({row:o})=>[e(ee,{href:o.url,target:"_blank",type:"primary"},{default:a(()=>[d(q(o.url),1)]),_:2},1032,["href"])]),_:1}),e(p,{prop:"code",label:"访问码",width:"100"}),e(p,{label:"操作",width:"180",fixed:"right"},{default:a(({row:o})=>[e(m,{type:"primary",link:"",size:"small",onClick:ue=>J(o)},{default:a(()=>[e(c,null,{default:a(()=>[e(f(_e))]),_:1}),l[17]||(l[17]=d(" 编辑 ",-1))]),_:1},8,["onClick"]),e(m,{type:"danger",link:"",size:"small",onClick:ue=>Q(o)},{default:a(()=>[e(c,null,{default:a(()=>[e(f(j))]),_:1}),l[18]||(l[18]=d(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,_.value]]),I("div",xe,[e(ae,{"current-page":k.value,"onUpdate:currentPage":l[1]||(l[1]=o=>k.value=o),"page-size":T.value,"onUpdate:pageSize":l[2]||(l[2]=o=>T.value=o),"page-sizes":[20,50,100,200],total:L.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1}),e(ne,{modelValue:w.value,"onUpdate:modelValue":l[10]||(l[10]=o=>w.value=o),title:x.value,width:"600px","close-on-click-modal":!1},{footer:a(()=>[e(m,{onClick:l[9]||(l[9]=o=>w.value=!1)},{default:a(()=>[...l[20]||(l[20]=[d("取消",-1)])]),_:1}),e(m,{type:"primary",onClick:O,loading:M.value},{default:a(()=>[...l[21]||(l[21]=[d("确定",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(oe,{model:n.value,rules:F,ref_key:"formRef",ref:z,"label-width":"100px"},{default:a(()=>[e(V,{label:"资源名称",prop:"name"},{default:a(()=>[e(D,{modelValue:n.value.name,"onUpdate:modelValue":l[3]||(l[3]=o=>n.value.name=o),placeholder:"请输入资源名称"},null,8,["modelValue"])]),_:1}),e(V,{label:"TMDB ID",prop:"tmdbId"},{default:a(()=>[e(D,{modelValue:n.value.tmdbId,"onUpdate:modelValue":l[4]||(l[4]=o=>n.value.tmdbId=o),placeholder:"请输入 TMDB ID（可选）"},{append:a(()=>[e(m,{onClick:Y,loading:R.value},{default:a(()=>[e(c,null,{default:a(()=>[e(f(N))]),_:1}),l[19]||(l[19]=d(" 搜索 ",-1))]),_:1},8,["loading"])]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"资源类型",prop:"type"},{default:a(()=>[e(te,{modelValue:n.value.type,"onUpdate:modelValue":l[5]||(l[5]=o=>n.value.type=o),placeholder:"请选择资源类型"},{default:a(()=>[e(g,{label:"国产剧",value:"国产剧"}),e(g,{label:"韩剧",value:"韩剧"}),e(g,{label:"美剧",value:"美剧"}),e(g,{label:"日剧",value:"日剧"}),e(g,{label:"电影",value:"电影"}),e(g,{label:"动漫",value:"动漫"}),e(g,{label:"综艺",value:"综艺"}),e(g,{label:"纪录片",value:"纪录片"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"资源大小",prop:"size"},{default:a(()=>[e(D,{modelValue:n.value.size,"onUpdate:modelValue":l[6]||(l[6]=o=>n.value.size=o),placeholder:"请输入资源大小（如：109.73 GB）"},null,8,["modelValue"])]),_:1}),e(V,{label:"分享链接",prop:"url"},{default:a(()=>[e(D,{modelValue:n.value.url,"onUpdate:modelValue":l[7]||(l[7]=o=>n.value.url=o),placeholder:"请输入 115 分享链接"},null,8,["modelValue"])]),_:1}),e(V,{label:"访问码",prop:"code"},{default:a(()=>[e(D,{modelValue:n.value.code,"onUpdate:modelValue":l[8]||(l[8]=o=>n.value.code=o),placeholder:"请输入访问码（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ue=se(ze,[["__scopeId","data-v-245514cb"]]);export{Ue as default};
