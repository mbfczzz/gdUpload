import{_ as R,a as m,o as j,c as A,b as c,d as l,w as t,i as V,y as U,f as o,e as a,j as s,t as G,E as y,Q as H}from"./index-DS01B9Je.js";import{a as k}from"./index-B9ygI19o.js";const Q={class:"emby-login-container"},z={class:"card-header"},J={key:2,class:"auth-info"},O={style:{"margin-top":"20px","text-align":"center"}},W={__name:"EmbyLogin",setup(X){const K=H(),g=m(!1),d=m(!1),f=m({}),n=m({serverUrl:"http://localhost:8096",username:"",password:""}),b=m(null),h={serverUrl:[{required:!0,message:"请输入服务器地址",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},B=async()=>{try{const r=await k.get("/api/emby/auth/status");r.data.code===200&&r.data.data.authenticated&&(d.value=!0,f.value=r.data.data)}catch(r){console.error("检查认证状态失败:",r)}},C=async()=>{b.value&&await b.value.validate(async r=>{var e,i;if(r){g.value=!0;try{const u=await k.post("/api/emby/auth/login",{username:n.value.username,password:n.value.password});u.data.code===200?(y.success("登录成功"),d.value=!0,f.value={userId:u.data.data.userId,authenticated:!0},n.value.password=""):y.error(u.data.message||"登录失败")}catch(u){y.error("登录失败: "+(((i=(e=u.response)==null?void 0:e.data)==null?void 0:i.message)||u.message))}finally{g.value=!1}}})},S=async()=>{try{await k.post("/api/emby/auth/logout"),y.success("已登出"),d.value=!1,f.value={}}catch(r){y.error("登出失败: "+r.message)}},q=()=>{K.push("/emby")};return j(()=>{B()}),(r,e)=>{const i=a("el-tag"),u=a("el-alert"),v=a("el-input"),_=a("el-form-item"),L=a("User"),w=a("el-icon"),E=a("el-button"),M=a("el-form"),x=a("el-descriptions-item"),N=a("el-descriptions"),T=a("SwitchButton"),D=a("VideoPlay"),P=a("el-card"),I=a("el-collapse-item"),F=a("el-collapse");return c(),A("div",Q,[l(P,{class:"login-card"},{header:t(()=>[o("div",z,[e[4]||(e[4]=o("h2",null,"Emby 登录",-1)),d.value?(c(),V(i,{key:0,type:"success"},{default:t(()=>[...e[3]||(e[3]=[s("已登录",-1)])]),_:1})):U("",!0)])]),default:t(()=>[d.value?U("",!0):(c(),V(u,{key:0,title:"使用用户名密码登录",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:t(()=>[...e[5]||(e[5]=[o("p",null,"如果你没有 API Key，可以使用 Emby 账号的用户名和密码登录。",-1),o("p",null,"登录后系统会自动获取访问令牌。",-1)])]),_:1})),d.value?(c(),A("div",J,[l(N,{column:1,border:""},{default:t(()=>[l(x,{label:"用户ID"},{default:t(()=>[s(G(f.value.userId),1)]),_:1}),l(x,{label:"认证状态"},{default:t(()=>[l(i,{type:"success"},{default:t(()=>[...e[7]||(e[7]=[s("已认证",-1)])]),_:1})]),_:1})]),_:1}),o("div",O,[l(E,{type:"danger",onClick:S},{default:t(()=>[l(w,null,{default:t(()=>[l(T)]),_:1}),e[8]||(e[8]=s(" 登出 ",-1))]),_:1}),l(E,{type:"primary",onClick:q},{default:t(()=>[l(w,null,{default:t(()=>[l(D)]),_:1}),e[9]||(e[9]=s(" 进入 Emby 管理 ",-1))]),_:1})])])):(c(),V(M,{key:1,model:n.value,rules:h,ref_key:"loginFormRef",ref:b,"label-width":"100px"},{default:t(()=>[l(_,{label:"服务器地址",prop:"serverUrl"},{default:t(()=>[l(v,{modelValue:n.value.serverUrl,"onUpdate:modelValue":e[0]||(e[0]=p=>n.value.serverUrl=p),placeholder:"http://your-emby-server:8096"},null,8,["modelValue"])]),_:1}),l(_,{label:"用户名",prop:"username"},{default:t(()=>[l(v,{modelValue:n.value.username,"onUpdate:modelValue":e[1]||(e[1]=p=>n.value.username=p),placeholder:"输入你的 Emby 用户名"},null,8,["modelValue"])]),_:1}),l(_,{label:"密码",prop:"password"},{default:t(()=>[l(v,{modelValue:n.value.password,"onUpdate:modelValue":e[2]||(e[2]=p=>n.value.password=p),type:"password","show-password":"",placeholder:"输入你的 Emby 密码"},null,8,["modelValue"])]),_:1}),l(_,null,{default:t(()=>[l(E,{type:"primary",onClick:C,loading:g.value,style:{width:"100%"}},{default:t(()=>[l(w,null,{default:t(()=>[l(L)]),_:1}),e[6]||(e[6]=s(" 登录 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]))]),_:1}),l(P,{style:{"margin-top":"20px"}},{header:t(()=>[...e[10]||(e[10]=[o("h3",null,"说明",-1)])]),default:t(()=>[l(F,null,{default:t(()=>[l(I,{title:"方式一：使用 API Key（推荐）",name:"1"},{default:t(()=>[...e[11]||(e[11]=[o("p",null,"如果你是服务器管理员，推荐使用 API Key 方式：",-1),o("ol",null,[o("li",null,"登录 Emby 管理后台"),o("li",null,"进入 设置 → 高级 → API 密钥"),o("li",null,"创建新的 API Key"),o("li",null,[s("在 "),o("code",null,"application.yml"),s(" 中配置")])],-1)])]),_:1}),l(I,{title:"方式二：使用用户名密码",name:"2"},{default:t(()=>[e[13]||(e[13]=o("p",null,"如果你使用别人的 Emby 服务器：",-1)),e[14]||(e[14]=o("ol",null,[o("li",null,"在上方表单中输入服务器地址"),o("li",null,"输入你的 Emby 用户名和密码"),o("li",null,"点击登录按钮"),o("li",null,"登录成功后即可使用所有功能")],-1)),l(u,{title:"注意",type:"warning",closable:!1,style:{"margin-top":"10px"}},{default:t(()=>[...e[12]||(e[12]=[o("p",null,"密码会通过 HTTPS 加密传输，但建议使用 API Key 方式更安全。",-1)])]),_:1})]),_:1}),l(I,{title:"方式三：向管理员索取 API Key",name:"3"},{default:t(()=>[...e[15]||(e[15]=[o("p",null,"联系 Emby 服务器管理员：",-1),o("blockquote",{style:{background:"#f5f5f7",padding:"10px","border-left":"3px solid #007aff"}},[s(" 你好，我需要通过 API 访问 Emby 服务器，"),o("br"),s(" 能否为我创建一个 API Key？"),o("br"),s(" 应用名称可以填：GD Upload Manager ")],-1),o("p",null,[s("管理员创建后会给你一个 API Key，配置到 "),o("code",null,"application.yml"),s(" 即可。")],-1)])]),_:1})]),_:1})]),_:1})])}}},$=R(W,[["__scopeId","data-v-e08f5425"]]);export{$ as default};
