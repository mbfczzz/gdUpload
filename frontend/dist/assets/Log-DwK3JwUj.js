import{r as A}from"./request-BSyjQB9W.js";import{_ as Z,a as k,r as F,o as h,c as ee,b as r,d as l,w as t,g as le,e as u,j as a,h as te,i as s,y as _,f as x,t as g,E as V}from"./index-D-xSYIE6.js";import"./index-B9ygI19o.js";function oe(R){return A({url:"/log/page",method:"get",params:R})}function ae(R){return A({url:"/log/clean",method:"delete",params:{days:R}})}const ne={class:"log-container"},ue={class:"card-header"},de={class:"header-actions"},re={style:{"white-space":"pre-wrap","word-wrap":"break-word"}},se={__name:"Log",setup(R){const N=k(!1),T=k([]),z=k(0),n=F({current:1,size:20,logType:null,logLevel:null,module:null,keyword:null}),C=k(!1),d=k(null),w=k(!1),L=F({days:30}),v=async()=>{N.value=!0;try{const i=await oe(n);i.code===200?(T.value=i.data.records||[],z.value=i.data.total||0):V.error(i.message||"加载日志失败")}catch(i){console.error("加载日志失败:",i),V.error("加载日志失败")}finally{N.value=!1}},S=()=>{n.current=1,v()},W=()=>{n.current=1,n.size=20,n.logType=null,n.logLevel=null,n.module=null,n.keyword=null,v()},B=i=>{d.value=i,C.value=!0},P=()=>{w.value=!0},$=async()=>{try{const i=await ae(L.days);i.code===200?(V.success(`成功清理 ${i.data} 条过期日志`),w.value=!1,v()):V.error(i.message||"清理日志失败")}catch(i){console.error("清理日志失败:",i),V.error("清理日志失败")}};return h(()=>{v()}),(i,e)=>{const j=u("Delete"),I=u("el-icon"),b=u("el-button"),c=u("el-option"),O=u("el-select"),y=u("el-form-item"),D=u("el-input"),q=u("Search"),M=u("Refresh"),E=u("el-form"),f=u("el-table-column"),p=u("el-tag"),G=u("el-table"),H=u("el-pagination"),J=u("el-card"),m=u("el-descriptions-item"),K=u("el-descriptions"),U=u("el-dialog"),Q=u("el-input-number"),X=u("el-alert"),Y=te("loading");return r(),ee("div",ne,[l(J,null,{header:t(()=>[x("div",ue,[e[11]||(e[11]=x("span",null,"系统日志",-1)),x("div",de,[l(b,{type:"danger",size:"small",onClick:P},{default:t(()=>[l(I,null,{default:t(()=>[l(j)]),_:1}),e[10]||(e[10]=a(" 清理过期日志 ",-1))]),_:1})])])]),default:t(()=>[l(E,{inline:!0,model:n,class:"search-form"},{default:t(()=>[l(y,{label:"日志类型"},{default:t(()=>[l(O,{modelValue:n.logType,"onUpdate:modelValue":e[0]||(e[0]=o=>n.logType=o),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:t(()=>[l(c,{label:"系统日志",value:1}),l(c,{label:"任务日志",value:2}),l(c,{label:"账号日志",value:3})]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"日志级别"},{default:t(()=>[l(O,{modelValue:n.logLevel,"onUpdate:modelValue":e[1]||(e[1]=o=>n.logLevel=o),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:t(()=>[l(c,{label:"INFO",value:"INFO"}),l(c,{label:"WARN",value:"WARN"}),l(c,{label:"ERROR",value:"ERROR"})]),_:1},8,["modelValue"])]),_:1}),l(y,{label:"模块"},{default:t(()=>[l(D,{modelValue:n.module,"onUpdate:modelValue":e[2]||(e[2]=o=>n.module=o),placeholder:"模块名称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(y,{label:"关键词"},{default:t(()=>[l(D,{modelValue:n.keyword,"onUpdate:modelValue":e[3]||(e[3]=o=>n.keyword=o),placeholder:"搜索日志内容",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(y,null,{default:t(()=>[l(b,{type:"primary",onClick:S},{default:t(()=>[l(I,null,{default:t(()=>[l(q)]),_:1}),e[12]||(e[12]=a(" 搜索 ",-1))]),_:1}),l(b,{onClick:W},{default:t(()=>[l(I,null,{default:t(()=>[l(M)]),_:1}),e[13]||(e[13]=a(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),le((r(),s(G,{data:T.value,stripe:"",style:{width:"100%"}},{default:t(()=>[l(f,{prop:"id",label:"ID",width:"80"}),l(f,{prop:"logType",label:"类型",width:"100"},{default:t(({row:o})=>[o.logType===1?(r(),s(p,{key:0,type:"info"},{default:t(()=>[...e[14]||(e[14]=[a("系统",-1)])]),_:1})):o.logType===2?(r(),s(p,{key:1,type:"warning"},{default:t(()=>[...e[15]||(e[15]=[a("任务",-1)])]),_:1})):o.logType===3?(r(),s(p,{key:2,type:"success"},{default:t(()=>[...e[16]||(e[16]=[a("账号",-1)])]),_:1})):_("",!0)]),_:1}),l(f,{prop:"logLevel",label:"级别",width:"100"},{default:t(({row:o})=>[o.logLevel==="INFO"?(r(),s(p,{key:0,type:"info"},{default:t(()=>[...e[17]||(e[17]=[a("INFO",-1)])]),_:1})):o.logLevel==="WARN"?(r(),s(p,{key:1,type:"warning"},{default:t(()=>[...e[18]||(e[18]=[a("WARN",-1)])]),_:1})):o.logLevel==="ERROR"?(r(),s(p,{key:2,type:"danger"},{default:t(()=>[...e[19]||(e[19]=[a("ERROR",-1)])]),_:1})):_("",!0)]),_:1}),l(f,{prop:"module",label:"模块",width:"120"}),l(f,{prop:"operation",label:"操作",width:"150"}),l(f,{prop:"message",label:"消息","min-width":"200","show-overflow-tooltip":""}),l(f,{prop:"createTime",label:"时间",width:"180"}),l(f,{label:"操作",width:"100",fixed:"right"},{default:t(({row:o})=>[l(b,{link:"",type:"primary",size:"small",onClick:ie=>B(o)},{default:t(()=>[...e[20]||(e[20]=[a(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,N.value]]),l(H,{"current-page":n.current,"onUpdate:currentPage":e[4]||(e[4]=o=>n.current=o),"page-size":n.size,"onUpdate:pageSize":e[5]||(e[5]=o=>n.size=o),"page-sizes":[20,50,100,200],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1}),l(U,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=o=>C.value=o),title:"日志详情",width:"600px"},{default:t(()=>[d.value?(r(),s(K,{key:0,column:1,border:""},{default:t(()=>[l(m,{label:"ID"},{default:t(()=>[a(g(d.value.id),1)]),_:1}),l(m,{label:"日志类型"},{default:t(()=>[d.value.logType===1?(r(),s(p,{key:0,type:"info"},{default:t(()=>[...e[21]||(e[21]=[a("系统",-1)])]),_:1})):d.value.logType===2?(r(),s(p,{key:1,type:"warning"},{default:t(()=>[...e[22]||(e[22]=[a("任务",-1)])]),_:1})):d.value.logType===3?(r(),s(p,{key:2,type:"success"},{default:t(()=>[...e[23]||(e[23]=[a("账号",-1)])]),_:1})):_("",!0)]),_:1}),l(m,{label:"日志级别"},{default:t(()=>[d.value.logLevel==="INFO"?(r(),s(p,{key:0,type:"info"},{default:t(()=>[...e[24]||(e[24]=[a("INFO",-1)])]),_:1})):d.value.logLevel==="WARN"?(r(),s(p,{key:1,type:"warning"},{default:t(()=>[...e[25]||(e[25]=[a("WARN",-1)])]),_:1})):d.value.logLevel==="ERROR"?(r(),s(p,{key:2,type:"danger"},{default:t(()=>[...e[26]||(e[26]=[a("ERROR",-1)])]),_:1})):_("",!0)]),_:1}),l(m,{label:"模块"},{default:t(()=>[a(g(d.value.module),1)]),_:1}),l(m,{label:"操作"},{default:t(()=>[a(g(d.value.operation),1)]),_:1}),l(m,{label:"消息"},{default:t(()=>[a(g(d.value.message),1)]),_:1}),d.value.detail?(r(),s(m,{key:0,label:"详情"},{default:t(()=>[x("pre",re,g(d.value.detail),1)]),_:1})):_("",!0),d.value.taskId?(r(),s(m,{key:1,label:"任务ID"},{default:t(()=>[a(g(d.value.taskId),1)]),_:1})):_("",!0),d.value.accountId?(r(),s(m,{key:2,label:"账号ID"},{default:t(()=>[a(g(d.value.accountId),1)]),_:1})):_("",!0),l(m,{label:"创建时间"},{default:t(()=>[a(g(d.value.createTime),1)]),_:1})]),_:1})):_("",!0)]),_:1},8,["modelValue"]),l(U,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=o=>w.value=o),title:"清理过期日志",width:"400px"},{footer:t(()=>[l(b,{onClick:e[8]||(e[8]=o=>w.value=!1)},{default:t(()=>[...e[27]||(e[27]=[a("取消",-1)])]),_:1}),l(b,{type:"danger",onClick:$},{default:t(()=>[...e[28]||(e[28]=[a("确认清理",-1)])]),_:1})]),default:t(()=>[l(E,{model:L,"label-width":"120px"},{default:t(()=>[l(y,{label:"保留天数"},{default:t(()=>[l(Q,{modelValue:L.days,"onUpdate:modelValue":e[7]||(e[7]=o=>L.days=o),min:1,max:365},null,8,["modelValue"])]),_:1}),l(y,null,{default:t(()=>[l(X,{title:"将删除指定天数之前的所有日志，此操作不可恢复",type:"warning",closable:!1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},_e=Z(se,[["__scopeId","data-v-554b51ac"]]);export{_e as default};
