import{r as V}from"./request-BSyjQB9W.js";import{_ as Z,a as c,o as ee,c as le,b as y,d as l,w as a,f as s,e as r,j as u,g as te,h as ae,i as _,y as k,t as $,E as i,k as oe}from"./index-D-xSYIE6.js";import"./index-B9ygI19o.js";function ne(){return V({url:"/emby/config/list",method:"get"})}function se(d){return V({url:"/emby/config/save",method:"post",data:d})}function re(d){return V({url:`/emby/config/${d}`,method:"delete"})}function ue(d){return V({url:`/emby/config/${d}/default`,method:"put"})}function ie(d){return V({url:"/emby/config/test",method:"post",data:d})}function de(d){return V({url:`/emby/config/${d}/toggle`,method:"put"})}const me={class:"emby-config-container"},pe={class:"header-content"},fe={class:"config-name"},ge={style:{display:"flex","flex-direction":"column",gap:"4px","align-items":"center"}},ce={__name:"EmbyConfig",setup(d){const I=c(!1),D=c(!1),N=c([]),v=c(!1),E=c("添加配置"),K=c(null),o=c({id:null,configName:"",serverUrl:"",apiKey:"",username:"",password:"",userId:"",timeout:3e4,enabled:!0,isDefault:!1,remark:""}),T={configName:[{required:!0,message:"请输入配置名称",trigger:"blur"}],serverUrl:[{required:!0,message:"请输入服务器地址",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"请输入有效的URL",trigger:"blur"}]},C=async()=>{I.value=!0;try{const n=await ne();N.value=n.data}catch(n){i.error("加载配置失败: "+n.message)}finally{I.value=!1}},B=()=>{E.value="添加配置",o.value={id:null,configName:"",serverUrl:"",apiKey:"",username:"",password:"",userId:"",timeout:3e4,enabled:!0,isDefault:!1,remark:""},v.value=!0},S=n=>{E.value="编辑配置",o.value={...n},v.value=!0},h=async()=>{K.value&&await K.value.validate(async n=>{if(n){if(!o.value.apiKey&&!o.value.username){i.warning("请至少配置一种认证方式（API Key 或 用户名密码）");return}if(o.value.apiKey&&!o.value.userId){i.warning("使用API Key时必须填写用户ID");return}D.value=!0;try{(await se(o.value)).code===200&&(i.success("保存成功"),v.value=!1,await C())}catch(e){i.error("保存失败: "+e.message)}finally{D.value=!1}}})},F=async n=>{try{await oe.confirm(`确定要删除配置"${n.configName}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await re(n.id)).code===200&&(i.success("删除成功"),await C())}catch(e){e!=="cancel"&&i.error("删除失败: "+e.message)}},q=async n=>{try{(await ue(n.id)).code===200&&(i.success("设置成功"),await C())}catch(e){i.error("设置失败: "+e.message)}},M=async n=>{const e=i({message:"正在测试连接...",type:"info",duration:0});try{const x=await ie({id:n.id});e.close(),x.data?i.success("连接测试成功"):i.error("连接测试失败，请检查服务器地址、用户名和密码")}catch(x){e.close(),i.error("测试失败: "+x.message)}},R=async n=>{try{(await de(n.id)).code===200&&i.success(n.enabled?"已启用":"已禁用")}catch(e){i.error("操作失败: "+e.message),n.enabled=!n.enabled}};return ee(()=>{C()}),(n,e)=>{const x=r("Plus"),w=r("el-icon"),f=r("el-button"),P=r("el-card"),p=r("el-table-column"),U=r("el-tag"),A=r("el-switch"),X=r("Connection"),j=r("Star"),L=r("Edit"),G=r("Delete"),H=r("el-table"),g=r("el-input"),m=r("el-form-item"),z=r("el-divider"),J=r("el-alert"),O=r("el-input-number"),Q=r("el-form"),W=r("el-dialog"),Y=ae("loading");return y(),le("div",me,[l(P,{class:"header-card"},{default:a(()=>[s("div",pe,[e[13]||(e[13]=s("h2",null,"Emby 配置管理",-1)),l(f,{type:"primary",onClick:B},{default:a(()=>[l(w,null,{default:a(()=>[l(x)]),_:1}),e[12]||(e[12]=u(" 添加配置 ",-1))]),_:1})])]),_:1}),l(P,null,{default:a(()=>[te((y(),_(H,{data:N.value,border:"",stripe:""},{default:a(()=>[l(p,{type:"index",label:"#",width:"60",align:"center"}),l(p,{prop:"configName",label:"配置名称","min-width":"150"},{default:a(({row:t})=>[s("div",fe,[t.isDefault?(y(),_(U,{key:0,type:"success",size:"small"},{default:a(()=>[...e[14]||(e[14]=[u("默认",-1)])]),_:1})):k("",!0),s("span",null,$(t.configName),1)])]),_:1}),l(p,{prop:"serverUrl",label:"服务器地址","min-width":"200","show-overflow-tooltip":""}),l(p,{prop:"apiKey",label:"认证方式",width:"150",align:"center"},{default:a(({row:t})=>[s("div",ge,[t.apiKey?(y(),_(U,{key:0,type:"success",size:"small"},{default:a(()=>[...e[15]||(e[15]=[u("API Key",-1)])]),_:1})):k("",!0),t.username?(y(),_(U,{key:1,type:"warning",size:"small"},{default:a(()=>[...e[16]||(e[16]=[u("用户名密码",-1)])]),_:1})):k("",!0),!t.apiKey&&!t.username?(y(),_(U,{key:2,type:"info",size:"small"},{default:a(()=>[...e[17]||(e[17]=[u("未配置",-1)])]),_:1})):k("",!0)])]),_:1}),l(p,{prop:"username",label:"用户名",width:"120"},{default:a(({row:t})=>[u($(t.username||"-"),1)]),_:1}),l(p,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(A,{modelValue:t.enabled,"onUpdate:modelValue":b=>t.enabled=b,onChange:b=>R(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(p,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),l(p,{label:"操作",width:"280",fixed:"right"},{default:a(({row:t})=>[l(f,{type:"primary",link:"",size:"small",onClick:b=>M(t)},{default:a(()=>[l(w,null,{default:a(()=>[l(X)]),_:1}),e[18]||(e[18]=u(" 测试 ",-1))]),_:1},8,["onClick"]),t.isDefault?k("",!0):(y(),_(f,{key:0,type:"success",link:"",size:"small",onClick:b=>q(t)},{default:a(()=>[l(w,null,{default:a(()=>[l(j)]),_:1}),e[19]||(e[19]=u(" 设为默认 ",-1))]),_:1},8,["onClick"])),l(f,{type:"primary",link:"",size:"small",onClick:b=>S(t)},{default:a(()=>[l(w,null,{default:a(()=>[l(L)]),_:1}),e[20]||(e[20]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),l(f,{type:"danger",link:"",size:"small",onClick:b=>F(t)},{default:a(()=>[l(w,null,{default:a(()=>[l(G)]),_:1}),e[21]||(e[21]=u(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,I.value]])]),_:1}),l(W,{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=t=>v.value=t),title:E.value,width:"600px"},{footer:a(()=>[l(f,{onClick:e[10]||(e[10]=t=>v.value=!1)},{default:a(()=>[...e[27]||(e[27]=[u("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:h,loading:D.value},{default:a(()=>[...e[28]||(e[28]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(Q,{ref_key:"formRef",ref:K,model:o.value,rules:T,"label-width":"120px"},{default:a(()=>[l(m,{label:"配置名称",prop:"configName"},{default:a(()=>[l(g,{modelValue:o.value.configName,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.configName=t),placeholder:"如：我的Emby服务器"},null,8,["modelValue"])]),_:1}),l(m,{label:"服务器地址",prop:"serverUrl"},{default:a(()=>[l(g,{modelValue:o.value.serverUrl,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.serverUrl=t),placeholder:"http://your-emby-server:8096"},null,8,["modelValue"])]),_:1}),l(z,{"content-position":"left"},{default:a(()=>[...e[22]||(e[22]=[u("认证方式（优先使用API Key）",-1)])]),_:1}),l(J,{title:"推荐：从Forward抓包获取API Key和用户ID",type:"info",closable:!1,style:{"margin-bottom":"15px"}},{default:a(()=>[...e[23]||(e[23]=[s("div",{style:{"font-size":"13px","line-height":"1.8"}},[s("p",{style:{margin:"0 0 8px 0"}},[s("strong",null,"方法1：使用API Key（推荐，不会被Cloudflare拦截）")]),s("p",{style:{margin:"0 0 4px 0","padding-left":"12px"}},"1. 在iPhone上安装抓包工具（如Stream）"),s("p",{style:{margin:"0 0 4px 0","padding-left":"12px"}},"2. 开启抓包，打开Forward app"),s("p",{style:{margin:"0 0 4px 0","padding-left":"12px"}},"3. 在抓包记录中找到Emby API请求"),s("p",{style:{margin:"0 0 4px 0","padding-left":"12px"}},[u("4. 复制请求头中的 "),s("code",null,"X-Emby-Token"),u(' 值到"API Key"字段')]),s("p",{style:{margin:"0 0 12px 0","padding-left":"12px"}},[u("5. 复制 "),s("code",null,"X-Emby-Authorization"),u(" 中的 "),s("code",null,'Emby UserId="xxx"'),u(' 值到"用户ID"字段')]),s("p",{style:{margin:"0"}},[s("strong",null,"方法2：使用用户名密码（备用，可能被Cloudflare拦截）")])],-1)])]),_:1}),l(m,{label:"API Key"},{default:a(()=>[l(g,{modelValue:o.value.apiKey,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.apiKey=t),type:"password","show-password":"",placeholder:"从Forward抓包获取的AccessToken（推荐）",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"用户ID"},{default:a(()=>[l(g,{modelValue:o.value.userId,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.userId=t),placeholder:"从Forward抓包获取的UserId（使用API Key时必填）",clearable:""},null,8,["modelValue"]),e[24]||(e[24]=s("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},' 在Forward请求头X-Emby-Authorization中找到 Emby UserId="xxx" 的值 ',-1))]),_:1}),l(m,{label:"用户名"},{default:a(()=>[l(g,{modelValue:o.value.username,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.username=t),placeholder:"Emby用户名（备用）",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"密码"},{default:a(()=>[l(g,{modelValue:o.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.password=t),type:"password","show-password":"",placeholder:"Emby密码（备用）",clearable:""},null,8,["modelValue"])]),_:1}),l(z,{"content-position":"left"},{default:a(()=>[...e[25]||(e[25]=[u("其他设置",-1)])]),_:1}),l(m,{label:"超时时间"},{default:a(()=>[l(O,{modelValue:o.value.timeout,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.timeout=t),min:5e3,max:12e4,step:1e3},null,8,["modelValue"]),e[26]||(e[26]=s("span",{style:{"margin-left":"10px",color:"#909399"}},"毫秒",-1))]),_:1}),l(m,{label:"启用"},{default:a(()=>[l(A,{modelValue:o.value.enabled,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.enabled=t)},null,8,["modelValue"])]),_:1}),l(m,{label:"设为默认"},{default:a(()=>[l(A,{modelValue:o.value.isDefault,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.isDefault=t)},null,8,["modelValue"])]),_:1}),l(m,{label:"备注"},{default:a(()=>[l(g,{modelValue:o.value.remark,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.remark=t),type:"textarea",rows:3,placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},_e=Z(ce,[["__scopeId","data-v-c17f7164"]]);export{_e as default};
