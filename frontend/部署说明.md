# 前端部署说明

## 服务器配置

**后端服务器地址**: `104.251.122.51:8099`

## 已修改的文件

### 1. vite.config.js
- 修改开发环境代理配置
- API 代理: `http://104.251.122.51:8099`
- WebSocket 代理: `ws://104.251.122.51:8099`

### 2. src/utils/request.js
- 修改生产环境 baseURL
- 开发环境: `/api` (通过 vite 代理)
- 生产环境: `http://104.251.122.51:8099/api` (直接访问)

## 部署步骤

### 方式一：本地开发模式（推荐用于测试）

```bash
cd F:\cluade\frontend

# 安装依赖（如果还没安装）
npm install

# 启动开发服务器
npm run dev
```

访问: `http://localhost:3000`

**说明**: 开发模式下，前端运行在本地 3000 端口，通过 vite 代理转发请求到服务器 `104.251.122.51:8099`

### 方式二：构建生产版本

```bash
cd F:\cluade\frontend

# 构建生产版本
npm run build
```

构建完成后，`dist` 目录包含所有静态文件。

#### 部署选项 A：使用 Nginx（推荐）

1. **安装 Nginx**（如果还没安装）
   ```bash
   # Windows
   下载 nginx-1.24.0.zip 并解压到 C:\nginx

   # Linux
   sudo apt install nginx
   ```

2. **配置 Nginx**

   创建配置文件 `nginx.conf` 或修改现有配置：

   ```nginx
   server {
       listen 80;
       server_name localhost;  # 或你的域名

       # 前端静态文件
       location / {
           root F:/cluade/frontend/dist;  # Windows路径
           # root /path/to/frontend/dist;  # Linux路径
           index index.html;
           try_files $uri $uri/ /index.html;
       }

       # 代理API请求到后端（可选，如果不想前端直接访问后端IP）
       location /api {
           proxy_pass http://104.251.122.51:8099;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
       }
   }
   ```

3. **启动 Nginx**
   ```bash
   # Windows
   cd C:\nginx
   start nginx

   # Linux
   sudo systemctl start nginx
   ```

4. **访问应用**
   ```
   http://localhost
   ```

#### 部署选项 B：使用 Node.js 静态服务器

```bash
# 安装 serve
npm install -g serve

# 启动静态服务器
cd F:\cluade\frontend
serve -s dist -p 80
```

访问: `http://localhost`

#### 部署选项 C：部署到服务器

如果要将前端也部署到 `104.251.122.51` 服务器：

```bash
# 1. 构建生产版本
npm run build

# 2. 上传 dist 目录到服务器
scp -r dist/* root@104.251.122.51:/var/www/html/

# 3. 在服务器上配置 Nginx
ssh root@104.251.122.51

# 编辑 Nginx 配置
sudo nano /etc/nginx/sites-available/default

# 添加配置
server {
    listen 80;
    server_name 104.251.122.51;

    location / {
        root /var/www/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://localhost:8099;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# 重启 Nginx
sudo systemctl restart nginx
```

访问: `http://104.251.122.51`

## 跨域问题处理

### 后端已配置 CORS

后端应该已经配置了 CORS，允许跨域请求。如果遇到跨域问题，检查后端配置：

```java
// 后端需要有这个配置
@Configuration
public class CorsConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(false)
                .maxAge(3600);
    }
}
```

### 如果仍有跨域问题

**方案1**: 使用 Nginx 反向代理（推荐）
- 前端和后端都通过同一个域名访问
- 前端: `http://yourdomain.com/`
- 后端: `http://yourdomain.com/api`

**方案2**: 修改后端允许的源
```java
.allowedOrigins("http://localhost:3000", "http://104.251.122.51")
```

## 环境变量配置（可选）

如果需要更灵活的配置，可以使用环境变量：

### 1. 创建 `.env.production` 文件

```bash
# F:\cluade\frontend\.env.production
VITE_API_BASE_URL=http://104.251.122.51:8099/api
```

### 2. 修改 `request.js`

```javascript
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 60000
})
```

### 3. 重新构建

```bash
npm run build
```

## 验证部署

### 1. 检查前端是否正常加载
- 打开浏览器访问前端地址
- 检查浏览器控制台是否有错误

### 2. 检查 API 连接
- 打开浏览器开发者工具 → Network 标签
- 尝试访问"账号管理"或"任务管理"页面
- 查看请求是否成功发送到 `104.251.122.51:8099`

### 3. 测试功能
- 添加账号
- 创建上传任务
- 查看任务列表

## 常见问题

### Q1: 页面空白
**原因**: 路由配置问题或资源加载失败

**解决**:
1. 检查浏览器控制台错误
2. 确认 `dist/index.html` 中的资源路径正确
3. 如果使用子路径部署，需要配置 `base` 选项

### Q2: API 请求失败
**原因**: 后端服务未启动或跨域问题

**解决**:
1. 检查后端服务是否运行: `curl http://104.251.122.51:8099/api/health`
2. 检查浏览器控制台的网络请求
3. 检查后端 CORS 配置

### Q3: 404 错误
**原因**: Nginx 配置问题或路由模式问题

**解决**:
1. 确保 Nginx 配置了 `try_files $uri $uri/ /index.html`
2. 检查前端路由模式（应该使用 history 模式）

### Q4: 连接超时
**原因**: 服务器防火墙或网络问题

**解决**:
1. 检查服务器防火墙是否开放 8099 端口
   ```bash
   # Linux
   sudo ufw allow 8099
   sudo firewall-cmd --add-port=8099/tcp --permanent
   ```
2. 检查云服务器安全组规则

## 性能优化建议

### 1. 启用 Gzip 压缩（Nginx）

```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
gzip_min_length 1000;
```

### 2. 配置缓存

```nginx
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### 3. 使用 CDN（可选）
- 将静态资源上传到 CDN
- 修改 `vite.config.js` 的 `base` 配置

## 当前配置总结

- **开发环境**:
  - 前端: `http://localhost:3000`
  - 后端: `http://104.251.122.51:8099` (通过代理)

- **生产环境**:
  - 前端: 根据部署方式决定
  - 后端: `http://104.251.122.51:8099/api` (直接访问)

- **API 路径**: `/api`
- **超时时间**: 60 秒

## 下一步

1. 选择部署方式（本地开发 / Nginx / Node.js serve / 服务器部署）
2. 执行部署步骤
3. 验证功能是否正常
4. 开始使用系统上传文件

如有问题，请检查：
- 浏览器控制台错误
- 网络请求状态
- 后端服务日志
