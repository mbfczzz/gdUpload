# Google Drive 多账号上传管理系统 - 使用说明

## 功能概述

本系统提供了一个完整的 Google Drive 多账号上传管理解决方案，支持：
- 服务器端文件扫描
- 多账号自动切换
- 任务管理（启动、暂停、恢复、取消、重试）
- 实时进度跟踪
- 文件上传状态监控

## 使用流程

### 1. 创建上传任务

**步骤：**
1. 访问前端页面，点击左侧菜单的"文件上传"
2. 填写任务信息：
   - **任务名称**：自定义任务名称（可选，系统会自动生成）
   - **源路径**：服务器上的文件路径，例如 `/data/files` 或 `D:\backup`
   - **目标路径**：Google Drive 目标路径，例如 `/backup` 或 `/2024/photos`
   - **递归扫描**：开启后会扫描子目录中的所有文件
3. 点击"扫描目录"按钮
4. 系统会显示扫描到的所有文件，包括文件名、路径、大小、类型
5. 选择要上传的文件（可以全选或单独选择）
6. 点击"创建任务"按钮
7. 系统会询问是否立即启动任务：
   - 点击"立即启动"：任务创建后立即开始上传
   - 点击"稍后启动"：任务创建后保持待开始状态，需要手动启动

### 2. 管理上传任务

**步骤：**
1. 访问前端页面，点击左侧菜单的"任务管理"
2. 在任务列表中可以看到所有任务及其状态

**任务状态说明：**
- **待开始**（蓝色）：任务已创建但未启动
- **上传中**（紫色）：任务正在执行上传
- **已完成**（绿色）：所有文件上传完成
- **已暂停**（橙色）：任务被手动暂停
- **已取消**（灰色）：任务被手动取消
- **失败**（红色）：任务执行失败

**可用操作：**

| 任务状态 | 可用按钮 | 说明 |
|---------|---------|------|
| 待开始 | 启动、文件、删除 | 点击"启动"开始上传 |
| 上传中 | 暂停、取消、文件、删除 | 可以暂停或取消任务 |
| 已暂停 | 启动、文件、删除 | 点击"启动"继续上传 |
| 已完成 | 文件、删除 | 查看上传结果 |
| 已取消 | 文件、删除 | 查看已上传的文件 |
| 失败 | 重试、文件、删除 | 点击"重试"重新上传失败的文件 |

### 3. 启动任务

**方式一：创建时立即启动**
- 在创建任务时，选择"立即启动"

**方式二：手动启动**
1. 进入"任务管理"页面
2. 找到状态为"待开始"或"已暂停"的任务
3. 点击该任务行右侧的"启动"按钮（紫色按钮，带播放图标）
4. 系统提示"任务已启动"
5. 任务状态变为"上传中"，进度条开始更新

### 4. 监控任务进度

**实时信息：**
- **进度条**：显示上传进度百分比
- **文件数**：显示"已上传/总文件数"，例如 "5 / 10"
- **大小**：显示"已上传大小/总大小"，例如 "1.2 GB / 2.5 GB"
- **状态标签**：显示当前任务状态

**查看详细文件列表：**
1. 点击任务行右侧的"文件"按钮
2. 弹出对话框显示该任务的所有文件
3. 可以看到每个文件的：
   - 文件名
   - 文件路径
   - 文件大小
   - 上传状态（待上传、上传中、已上传、失败）
   - 上传时间
   - 错误信息（如果失败）

### 5. 暂停和恢复任务

**暂停任务：**
1. 找到状态为"上传中"的任务
2. 点击"暂停"按钮（橙色按钮）
3. 任务状态变为"已暂停"
4. 当前正在上传的文件会完成，后续文件不会上传

**恢复任务：**
1. 找到状态为"已暂停"的任务
2. 点击"启动"按钮
3. 任务从暂停的位置继续上传

### 6. 取消任务

1. 找到状态为"上传中"的任务
2. 点击"取消"按钮（红色按钮）
3. 确认取消操作
4. 任务状态变为"已取消"
5. 已上传的文件保留，未上传的文件不会继续

### 7. 重试失败的任务

1. 找到状态为"失败"的任务
2. 点击"重试"按钮（绿色按钮）
3. 系统会重新上传失败的文件
4. 任务状态变为"上传中"

### 8. 删除任务

**单个删除：**
1. 点击任务行右侧的"删除"按钮
2. 确认删除操作
3. 任务及其关联的文件信息会被删除

**批量删除：**
1. 勾选要删除的任务（表格左侧的复选框）
2. 点击表格上方的"批量删除"按钮
3. 确认删除操作

### 9. 搜索和筛选任务

**按任务名称搜索：**
1. 在"任务名称"输入框中输入关键词
2. 点击"查询"按钮

**按状态筛选：**
1. 在"任务状态"下拉框中选择状态
2. 点击"查询"按钮

**重置筛选：**
- 点击"重置"按钮清空所有筛选条件

## 系统架构

### 后端技术栈
- Spring Boot 2.7.18
- MyBatis-Plus 3.5.3.1
- Java 8
- MySQL 8.0+
- Rclone（Google Drive 上传工具）

### 前端技术栈
- Vue 3
- Element Plus
- Axios
- Vue Router

### 核心功能模块

**1. 账号管理模块**
- 管理多个 Google Drive 账号
- 自动监控账号配额
- 智能选择可用账号

**2. 任务管理模块**
- 创建、启动、暂停、恢复、取消、重试任务
- 实时更新任务进度
- 任务状态管理

**3. 文件管理模块**
- 服务器端文件扫描
- 文件状态跟踪
- 失败文件重试

**4. 上传核心模块**
- 异步上传执行
- 自动账号切换
- 断点续传支持

## 注意事项

1. **Rclone 配置**：确保服务器上已安装并配置好 rclone
2. **账号配额**：系统会自动监控账号配额，达到上限时自动切换账号
3. **并发上传**：默认配置为 3 个并发传输，可在配置文件中调整
4. **文件路径**：源路径必须是服务器上的有效路径
5. **数据库**：首次使用需要执行 schema.sql 创建数据库表

## 配置文件

**application.yml 配置示例：**

```yaml
app:
  rclone:
    path: /usr/bin/rclone  # rclone 可执行文件路径
    config-path: ~/.config/rclone/rclone.conf  # rclone 配置文件路径
    concurrent-transfers: 3  # 并发传输数
    buffer-size: 16M  # 缓冲区大小
    timeout: 3600  # 超时时间（秒）
```

## 常见问题

**Q: 任务启动后没有反应？**
A: 检查以下几点：
- 确认 rclone 已正确安装和配置
- 检查账号是否可用（未达到配额上限）
- 查看后端日志是否有错误信息

**Q: 文件上传失败？**
A: 可能的原因：
- 网络连接问题
- 账号配额已满
- 文件路径不存在
- rclone 配置错误

**Q: 如何查看上传日志？**
A: 查看后端日志文件，或在任务的文件列表中查看错误信息

**Q: 可以同时运行多个任务吗？**
A: 可以，系统支持多任务并发执行

## 技术支持

如有问题，请查看：
- 后端日志：`logs/application.log`
- 数据库表：`system_log` 表记录了详细的系统日志
- 前端控制台：浏览器开发者工具的 Console 面板
