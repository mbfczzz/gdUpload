import{_ as Ce,a as v,r as G,k as xe,o as he,l as we,c as Ve,b as I,d as t,w as l,g as Be,e as u,u as b,m as Ne,n as ze,j as n,f,s as O,p as Te,q as Se,h as Ee,i as K,t as V,v as W,x as Ue,y as Ae,z,E as x}from"./index-BfPiXcrJ.js";import{r as k}from"./request-BS_vZder.js";import"./index-B9ygI19o.js";function H(s){return k({url:"/account/page",method:"get",params:s})}function De(s){return k({url:"/account",method:"post",data:s})}function Le(s){return k({url:"/account",method:"put",data:s})}function Me(s){return k({url:`/account/${s}`,method:"delete"})}function $e(s){return k({url:"/account/batch",method:"delete",data:s})}function Ge(s,B){return k({url:`/account/${s}/status`,method:"put",params:{status:B}})}function Ie(s){return k({url:`/account/${s}/reset-quota`,method:"put"})}const Qe={class:"account-container"},Re={__name:"Account",setup(s){const B=v("");let T=null,S=null;const Q=()=>{const o=new Date;B.value=o.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},h=G({keyword:""}),i=G({current:1,size:10,total:0}),E=v([]),U=v(!1),A=v([]),C=v(!1),D=v("新增账号"),N=v(null),r=G({id:null,accountName:"",accountEmail:"",rcloneConfigName:"",dailyLimit:805306368e3,priority:0,status:1,remark:""}),R=xe({get:()=>Math.round(r.dailyLimit/1073741824),set:o=>{r.dailyLimit=o*1073741824}}),J={accountName:[{required:!0,message:"请输入账号名称",trigger:"blur"}],accountEmail:[{required:!0,message:"请输入账号邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],rcloneConfigName:[{required:!0,message:"请输入rclone配置名称",trigger:"blur"}]},L=o=>{if(o===0)return"0 B";const e=1024,c=["B","KB","MB","GB","TB"],g=Math.floor(Math.log(o)/Math.log(e));return(o/Math.pow(e,g)).toFixed(2)+" "+c[g]},q=o=>o.dailyLimit===0?0:Math.round(o.usedQuota/o.dailyLimit*100),X=o=>{const e=q(o);return e>=90?"#F56C6C":e>=70?"#E6A23C":"#67C23A"},Y=o=>({0:"info",1:"success",2:"danger"})[o]||"info",Z=o=>({0:"禁用",1:"启用",2:"已达上限"})[o]||"未知",d=async()=>{U.value=!0;try{const o={current:i.current,size:i.size,keyword:h.keyword},e=await H(o);E.value=e.data.records,i.total=e.data.total}catch(o){console.error("查询失败:",o)}finally{U.value=!1}},ee=async()=>{try{const o={current:i.current,size:i.size,keyword:h.keyword},e=await H(o);E.value=e.data.records,i.total=e.data.total}catch(o){console.error("静默刷新失败:",o)}},te=()=>{h.keyword="",i.current=1,d()},le=o=>{A.value=o.map(e=>e.id)},ae=()=>{D.value="新增账号",Object.assign(r,{id:null,accountName:"",accountEmail:"",rcloneConfigName:"",dailyLimit:805306368e3,priority:0,status:1,remark:""}),C.value=!0},oe=o=>{D.value="编辑账号",Object.assign(r,o),C.value=!0},ne=async()=>{N.value&&await N.value.validate(async o=>{if(o)try{r.id?(await Le(r),x.success("更新成功")):(await De(r),x.success("添加成功")),C.value=!1,d()}catch(e){console.error("提交失败:",e)}})},re=()=>{var o;(o=N.value)==null||o.resetFields()},ue=o=>{z.confirm("确定要删除该账号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Me(o.id),x.success("删除成功"),d()}catch(e){console.error("删除失败:",e)}})},se=()=>{z.confirm("确定要删除选中的账号吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await $e(A.value),x.success("删除成功"),d()}catch(o){console.error("删除失败:",o)}})},ie=o=>{const e=o.status===1?0:1,c=e===1?"启用":"禁用";z.confirm(`确定要${c}该账号吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ge(o.id,e),x.success(`${c}成功`),d()}catch(g){console.error("操作失败:",g)}})},ce=o=>{z.confirm("确定要重置该账号的配额吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Ie(o.id),x.success("重置成功"),d()}catch(e){console.error("重置失败:",e)}})};return he(()=>{Q(),T=setInterval(Q,1e3),d(),S=setInterval(ee,3e4)}),we(()=>{T&&clearInterval(T),S&&clearInterval(S)}),(o,e)=>{const c=u("el-icon"),g=u("el-statistic"),_=u("el-col"),j=u("el-alert"),M=u("el-row"),w=u("el-input"),m=u("el-button"),p=u("el-table-column"),de=u("el-progress"),pe=u("el-tag"),me=u("el-tooltip"),fe=u("el-table"),ge=u("el-pagination"),_e=u("el-card"),y=u("el-form-item"),F=u("el-input-number"),P=u("el-radio"),ye=u("el-radio-group"),ve=u("el-form"),be=u("el-dialog"),ke=Ee("loading");return I(),Ve("div",Qe,[t(_e,null,{default:l(()=>[t(M,{gutter:20,class:"time-info-bar"},{default:l(()=>[t(_,{span:8},{default:l(()=>[t(g,{title:"当前时间",value:B.value},{prefix:l(()=>[t(c,null,{default:l(()=>[t(b(Ne))]),_:1})]),_:1},8,["value"])]),_:1}),t(_,{span:8},{default:l(()=>[t(g,{title:"账号总数",value:i.total},{prefix:l(()=>[t(c,null,{default:l(()=>[t(b(ze))]),_:1})]),_:1},8,["value"])]),_:1}),t(_,{span:8},{default:l(()=>[t(j,{title:"自动刷新",type:"success",closable:!1,"show-icon":""},{default:l(()=>[...e[12]||(e[12]=[n(" 每30秒自动刷新账号状态 ",-1)])]),_:1})]),_:1})]),_:1}),t(M,{gutter:20,style:{"margin-top":"15px"}},{default:l(()=>[t(_,{span:24},{default:l(()=>[t(j,{title:"Google Drive 配额说明（重要）",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...e[13]||(e[13]=[n(" • ",-1),f("strong",null,"滚动24小时窗口",-1),n("：Google Drive的750GB限制是动态的，不是固定时间重置",-1),f("br",null,null,-1),n(" • 例如：今天10:00上传100GB → 明天10:00这100GB配额自动释放",-1),f("br",null,null,-1),n(" • ",-1),f("strong",null,"已使用",-1),n("和",-1),f("strong",null,"剩余配额",-1),n("显示的是过去24小时内的实时数据",-1),f("br",null,null,-1),n(' • 当配额用完时状态自动变为"已达上限"，配额释放后自动恢复"启用"',-1),f("br",null,null,-1),n(" • 系统每30秒自动刷新，无需手动操作 ",-1)])]),_:1})]),_:1})]),_:1}),t(M,{gutter:20,class:"search-bar"},{default:l(()=>[t(_,{span:6},{default:l(()=>[t(w,{modelValue:h.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>h.keyword=a),placeholder:"搜索账号名称或邮箱",clearable:"",onClear:d},{prefix:l(()=>[t(c,null,{default:l(()=>[t(b(O))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(_,{span:6},{default:l(()=>[t(m,{type:"primary",onClick:d},{default:l(()=>[t(c,null,{default:l(()=>[t(b(O))]),_:1}),e[14]||(e[14]=n(" 搜索 ",-1))]),_:1}),t(m,{onClick:te},{default:l(()=>[...e[15]||(e[15]=[n("重置",-1)])]),_:1})]),_:1}),t(_,{span:12,class:"text-right"},{default:l(()=>[t(m,{type:"primary",onClick:ae},{default:l(()=>[t(c,null,{default:l(()=>[t(b(Te))]),_:1}),e[16]||(e[16]=n(" 新增账号 ",-1))]),_:1}),t(m,{type:"danger",disabled:A.value.length===0,onClick:se},{default:l(()=>[t(c,null,{default:l(()=>[t(b(Se))]),_:1}),e[17]||(e[17]=n(" 批量删除 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1}),Be((I(),K(fe,{data:E.value,style:{width:"100%","margin-top":"20px"},onSelectionChange:le},{default:l(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"accountName",label:"账号名称",width:"150"}),t(p,{prop:"accountEmail",label:"账号邮箱",width:"200"}),t(p,{prop:"rcloneConfigName",label:"Rclone配置",width:"150"}),t(p,{label:"每日限制",width:"120"},{default:l(({row:a})=>[n(V(L(a.dailyLimit)),1)]),_:1}),t(p,{label:"已使用",width:"120"},{default:l(({row:a})=>[f("span",{style:W({color:a.status===2?"#f56c6c":""})},V(L(a.usedQuota)),5)]),_:1}),t(p,{label:"剩余配额",width:"120"},{default:l(({row:a})=>[f("span",{style:W({color:a.remainingQuota<=0?"#f56c6c":"#67c23a",fontWeight:a.remainingQuota<=0?"bold":"normal"})},V(L(a.remainingQuota)),5)]),_:1}),t(p,{label:"使用率",width:"150"},{default:l(({row:a})=>[t(de,{percentage:q(a),color:X(a)},null,8,["percentage","color"])]),_:1}),t(p,{label:"状态",width:"120"},{default:l(({row:a})=>[t(pe,{type:Y(a.status),effect:a.status===2?"dark":"light"},{default:l(()=>[n(V(Z(a.status)),1)]),_:2},1032,["type","effect"]),a.status===2?(I(),K(me,{key:0,content:"配额已用完，等待重置",placement:"top"},{default:l(()=>[t(c,{style:{"margin-left":"5px",color:"#f56c6c"}},{default:l(()=>[t(b(Ae))]),_:1})]),_:1})):Ue("",!0)]),_:1}),t(p,{prop:"priority",label:"优先级",width:"80"}),t(p,{label:"操作",fixed:"right",width:"250"},{default:l(({row:a})=>[t(m,{link:"",type:"primary",onClick:$=>oe(a)},{default:l(()=>[...e[18]||(e[18]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:a.status===1?"warning":"success",onClick:$=>ie(a)},{default:l(()=>[n(V(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(m,{link:"",type:"primary",onClick:$=>ce(a)},{default:l(()=>[...e[19]||(e[19]=[n(" 重置配额 ",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:"danger",onClick:$=>ue(a)},{default:l(()=>[...e[20]||(e[20]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ke,U.value]]),t(ge,{"current-page":i.current,"onUpdate:currentPage":e[1]||(e[1]=a=>i.current=a),"page-size":i.size,"onUpdate:pageSize":e[2]||(e[2]=a=>i.size=a),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(be,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=a=>C.value=a),title:D.value,width:"600px",onClose:re},{footer:l(()=>[t(m,{onClick:e[10]||(e[10]=a=>C.value=!1)},{default:l(()=>[...e[23]||(e[23]=[n("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:ne},{default:l(()=>[...e[24]||(e[24]=[n("确定",-1)])]),_:1})]),default:l(()=>[t(ve,{ref_key:"formRef",ref:N,model:r,rules:J,"label-width":"120px"},{default:l(()=>[t(y,{label:"账号名称",prop:"accountName"},{default:l(()=>[t(w,{modelValue:r.accountName,"onUpdate:modelValue":e[3]||(e[3]=a=>r.accountName=a),placeholder:"请输入账号名称"},null,8,["modelValue"])]),_:1}),t(y,{label:"账号邮箱",prop:"accountEmail"},{default:l(()=>[t(w,{modelValue:r.accountEmail,"onUpdate:modelValue":e[4]||(e[4]=a=>r.accountEmail=a),placeholder:"请输入账号邮箱"},null,8,["modelValue"])]),_:1}),t(y,{label:"Rclone配置",prop:"rcloneConfigName"},{default:l(()=>[t(w,{modelValue:r.rcloneConfigName,"onUpdate:modelValue":e[5]||(e[5]=a=>r.rcloneConfigName=a),placeholder:"请输入rclone配置名称"},null,8,["modelValue"])]),_:1}),t(y,{label:"每日限制(GB)",prop:"dailyLimit"},{default:l(()=>[t(F,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=a=>R.value=a),min:1,max:1e4,placeholder:"默认750GB"},null,8,["modelValue"])]),_:1}),t(y,{label:"优先级",prop:"priority"},{default:l(()=>[t(F,{modelValue:r.priority,"onUpdate:modelValue":e[7]||(e[7]=a=>r.priority=a),min:0,max:100,placeholder:"数字越大优先级越高"},null,8,["modelValue"])]),_:1}),t(y,{label:"状态",prop:"status"},{default:l(()=>[t(ye,{modelValue:r.status,"onUpdate:modelValue":e[8]||(e[8]=a=>r.status=a)},{default:l(()=>[t(P,{label:1},{default:l(()=>[...e[21]||(e[21]=[n("启用",-1)])]),_:1}),t(P,{label:0},{default:l(()=>[...e[22]||(e[22]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"备注",prop:"remark"},{default:l(()=>[t(w,{modelValue:r.remark,"onUpdate:modelValue":e[9]||(e[9]=a=>r.remark=a),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Pe=Ce(Re,[["__scopeId","data-v-241ed62a"]]);export{Pe as default};
