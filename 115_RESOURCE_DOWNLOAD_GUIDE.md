# 115 资源智能下载功能使用说明

## 功能概述

在 Emby 媒体库中，可以直接下载电影和电视剧资源到 115 网盘。系统会优先从 115 资源库智能匹配，如果没有找到则使用搜索引擎搜索。

## 支持的媒体类型

### ✅ 电影 (Movie)
- 显示"搜索下载"按钮
- 点击后搜索并下载整部电影

### ✅ 电视剧 (Series)
- 显示"搜索下载"按钮
- 点击后搜索并下载整部电视剧（所有季所有集）

### ❌ 单集 (Episode)
- **不显示**"搜索下载"按钮
- 原因：单集属于电视剧的一部分，应该下载整部电视剧而不是单集

## 使用方法

### 1. 下载电影

**示例**：下载《大秦赋 (2020)》电影版

1. 在 Emby 管理页面，找到电影类型的媒体项
2. 点击"搜索下载"按钮
3. 系统自动：
   - 从 115 资源库搜索"大秦赋 (2020)"
   - 找到匹配资源后直接转存
   - 如果没找到，使用搜索引擎搜索

### 2. 下载电视剧

**示例**：下载《大秦赋 (2020)》电视剧

**Emby 路径**：
```
/CloudNAS/CloudDrive/media2/media/电视剧/国产剧/大秦赋 (2020) {tmdb-114043}/Season 1/大秦赋.2020.S01E69.第69集.strm
```

**操作步骤**：

1. 在 Emby 管理页面，找到"大秦赋 (2020)"（类型：Series）
2. 点击"搜索下载"按钮
3. 系统自动：
   - 使用名称"大秦赋 (2020)"搜索
   - 从 115 资源库智能匹配
   - 找到后转存整部电视剧（所有季所有集）

**注意**：
- ❌ 不要点击单集（Episode）的下载按钮（因为没有这个按钮）
- ✅ 应该点击电视剧（Series）的下载按钮
- 下载的是整部电视剧，不是单集

## 搜索逻辑

### 1. 优先从 115 资源库匹配

系统会使用以下信息进行智能匹配：
- **名称**：如"大秦赋"
- **年份**：如 2020
- **原始名称**：如英文名

**匹配算法**：
- 完全匹配：+1000分
- 包含匹配：+500分
- 简化匹配：+300分
- 关键词匹配：+100分/词
- 年份匹配：+200分

### 2. 降级到搜索引擎

如果 115 资源库没有找到匹配资源，系统会：
1. 自动使用搜索引擎搜索
2. 显示搜索结果列表
3. 用户可以手动选择并转存

## 媒体类型识别

### 在 Emby 中的层级结构

```
电视剧 (Series)
  └─ 第1季 (Season)
      ├─ 第1集 (Episode)
      ├─ 第2集 (Episode)
      └─ 第3集 (Episode)
```

### 下载按钮显示规则

| 类型 | 显示下载按钮 | 说明 |
|------|------------|------|
| Movie | ✅ 是 | 下载整部电影 |
| Series | ✅ 是 | 下载整部电视剧 |
| Season | ❌ 否 | 季是电视剧的一部分 |
| Episode | ❌ 否 | 单集是电视剧的一部分 |

## 转存记录

所有转存操作都会记录到数据库：
- 点击"转存记录"按钮查看历史
- 记录包括：资源名称、转存状态、转存时间等
- 已转存的媒体项会显示"已转存"标签

## 示例场景

### 场景1：下载国产剧

**Emby 媒体项**：
- 名称：`大秦赋`
- 类型：`Series`
- 年份：`2020`

**115 资源库**：
- 资源名称：`大秦赋 (2020)`
- 类型：`国产剧`
- 大小：`109.73 GB`

**操作**：
1. 找到"大秦赋"（Series 类型）
2. 点击"搜索下载"
3. 系统匹配到"大秦赋 (2020)"
4. 自动转存到 115 网盘
5. 完成！

### 场景2：下载电影

**Emby 媒体项**：
- 名称：`流浪地球`
- 类型：`Movie`
- 年份：`2019`

**操作**：
1. 找到"流浪地球"（Movie 类型）
2. 点击"搜索下载"
3. 系统搜索匹配资源
4. 找到后自动转存
5. 完成！

## 常见问题

### Q1：为什么单集（Episode）没有下载按钮？

**A**：单集是电视剧的一部分，应该下载整部电视剧而不是单集。请找到电视剧（Series）类型的媒体项，点击它的"搜索下载"按钮。

### Q2：如何下载整部电视剧？

**A**：
1. 在媒体库中找到电视剧（Series）类型的媒体项
2. 不要点击单集（Episode）
3. 点击电视剧（Series）的"搜索下载"按钮
4. 系统会下载整部电视剧（所有季所有集）

### Q3：115 资源库没有找到怎么办？

**A**：系统会自动降级到搜索引擎搜索，您可以从搜索结果中手动选择资源进行转存。

### Q4：如何查看转存历史？

**A**：点击媒体项的"转存记录"按钮，可以查看该媒体项的所有转存历史记录。

### Q5：如何添加资源到 115 资源库？

**A**：直接在数据库的 `115_resource` 表中插入数据：

```sql
INSERT INTO `115_resource` (`name`, `type`, `size`, `url`, `code`)
VALUES ('大秦赋 (2020)', '国产剧', '109.73', 'https://115.com/s/xxx', '1234');
```

## 技术说明

### 前端判断逻辑

```javascript
// 显示下载按钮的条件
v-if="row.type === 'Movie' || row.type === 'Series'"
```

### 搜索关键词

- 优先使用原始名称（originalTitle）
- 如果没有原始名称，使用中文名称（name）
- 自动清理特殊字符
- 保留年份信息用于精确匹配

### 对话框标题

- 电影：`搜索并下载电影`
- 电视剧：`搜索并下载电视剧`

---

**更新日期**: 2026-02-03
**功能状态**: ✅ 已完成
