# Emby 管理模块使用说明

## 重要提示 ⚠️

**首次使用或数据库为空时，必须先点击"同步所有数据"按钮！**

## 使用流程

### 1. 首次使用

1. 启动应用后，访问 Emby 管理页面
2. 如果看到红色警告提示"首次使用需要同步数据"，说明数据库中还没有数据
3. 点击页面顶部的 **"同步所有数据"** 按钮
4. 等待同步完成（根据媒体库大小，可能需要几分钟到几十分钟）
5. 同步完成后，即可正常使用所有功能

### 2. 同步过程

点击"同步所有数据"后，系统会：

1. **清空旧数据** - 删除数据库中的所有旧缓存
2. **同步媒体库列表** - 获取所有媒体库信息
3. **同步媒体项** - 遍历每个媒体库，全量获取所有媒体项
   - 每次获取 100 条
   - 批量保存到数据库
   - 后台日志会显示同步进度
4. **同步元数据** - 获取类型、标签、工作室信息
5. **完成** - 显示同步结果统计

### 3. 同步完成后

同步完成后，页面会显示：
- ✅ 媒体库列表
- ✅ 类型列表
- ✅ 标签列表
- ✅ 工作室列表

所有查询都从数据库读取，响应速度非常快（毫秒级）。

### 4. 查看媒体项

1. 在媒体库列表中，点击"查看媒体项"按钮
2. 弹出对话框显示该媒体库的所有媒体项
3. 支持分页浏览
4. 支持搜索功能

### 5. 查看媒体项详情

1. 在媒体项列表中，点击"详情"按钮
2. 查看媒体项的完整信息：
   - 基本信息（名称、年份、评分等）
   - 类型、标签、工作室
   - 文件路径和大小
   - 媒体源信息

### 6. 更新数据

当 Emby 服务器的数据有更新时（如添加了新电影），需要重新同步：

1. 点击"同步所有数据"按钮
2. 系统会清空旧数据，重新全量同步
3. 同步完成后，即可看到最新数据

## 功能说明

### 测试连接

- 测试与 Emby 服务器的连接是否正常
- 成功后会显示服务器信息

### 同步所有数据 ⭐

- **最重要的功能**
- 一次性全量同步所有数据到数据库
- 首次使用必须执行
- 数据更新时需要重新执行

### 清空缓存

- 清空数据库中的所有缓存数据
- 清空后需要重新同步

### 刷新按钮

- 媒体库列表、类型、标签、工作室都有刷新按钮
- 点击后重新从数据库读取数据
- **注意**：刷新不会从 Emby API 获取新数据，只是重新查询数据库

## 常见问题

### Q1: 为什么页面显示"暂无数据"？

**A**: 数据库中还没有数据，需要先点击"同步所有数据"按钮。

### Q2: 同步需要多长时间？

**A**: 取决于媒体库的大小：
- 小型媒体库（几百个媒体项）：1-2 分钟
- 中型媒体库（几千个媒体项）：5-10 分钟
- 大型媒体库（上万个媒体项）：20-30 分钟或更长

### Q3: 同步过程中可以关闭页面吗？

**A**: 不建议。同步是一个长时间运行的任务，关闭页面可能导致同步中断。建议等待同步完成。

### Q4: 如何查看同步进度？

**A**: 查看后端日志，会显示详细的同步进度：
```
正在同步媒体库 [1/5]: 电影
获取第 1 批数据 (100条)
获取第 2 批数据 (100条)
同步进度: 200/1234 (16%)
...
```

### Q5: 同步失败怎么办？

**A**:
1. 检查 Emby 服务器是否正常运行
2. 检查网络连接
3. 查看后端日志，找到具体错误信息
4. 重新点击"同步所有数据"按钮

### Q6: 添加了新电影，如何更新？

**A**: 重新点击"同步所有数据"按钮，系统会清空旧数据并重新全量同步。

### Q7: 查询速度如何？

**A**: 所有查询都从数据库读取，响应速度非常快，通常在几毫秒到几十毫秒之间。

### Q8: 数据库会占用多少空间？

**A**: 取决于媒体库大小，大致估算：
- 每个媒体项约 2-5 KB
- 1000 个媒体项约 2-5 MB
- 10000 个媒体项约 20-50 MB

### Q9: 可以定时自动同步吗？

**A**: 目前需要手动点击同步。未来可以添加定时任务功能，在每天凌晨自动同步。

### Q10: 同步会影响 Emby 服务器性能吗？

**A**: 同步过程会频繁调用 Emby API，可能会对服务器造成一定压力。建议在服务器空闲时段（如凌晨）进行同步。

## 技术说明

### 数据流向

```
Emby 服务器
    ↓ (同步时)
后端 API
    ↓
数据库缓存
    ↓ (查询时)
前端页面
```

### 缓存策略

- **旧策略**：按需加载 + 懒加载缓存
- **新策略**：一次性全量同步 + 数据库查询

### 优势

✅ 查询速度快（毫秒级）
✅ 减少对 Emby 服务器的请求
✅ 数据一致性好
✅ 支持离线查询（同步后）

### 注意事项

⚠️ 首次同步必须执行
⚠️ 同步过程较长，需要耐心等待
⚠️ 数据更新需要重新同步
⚠️ 需要足够的数据库空间

## 相关文档

- 详细技术说明：`EMBY_CACHE_STRATEGY_UPDATE.md`
- 修改总结：`EMBY_CACHE_MODIFICATION_SUMMARY.md`
- API 文档：查看后端 `EmbyController.java`

---

**最后更新**: 2026-02-02
